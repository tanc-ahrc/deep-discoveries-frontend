{"version":3,"sources":["DetailSelector.js","ScaledImage.js","DetailSelection.js","BasicSearchSidebar.js","SearchDatum.js","Backend.js","BasicSearchResults.js","BasicSearch.js","Start.js","App.js","reportWebVitals.js","index.js"],"names":["DetailSelector","src","shadingColor","shadingOpacity","selections","setSelections","props","containerId","useState","Image","image","naturalWidth","width","setWidth","naturalHeight","height","setHeight","React","useEffect","widthScale","heightScale","scale","selectorSize","newSelections","initHole","x","y","opacity","Konva","Circle","radius","fillPatternImage","fillPatternOffset","fillPatternScale","stage","Stage","container","background","shading","Rect","fill","strokeWidth","visible","select","draggable","stroke","layer","Layer","add","forEach","selection","hole","holeScale","fillPatternScaleX","fillPatternScaleY","console","error","scaledX","Math","max","min","scaledY","scaledRadius","on","e","style","cursor","draw","evt","layerX","layerY","batchDraw","push","s","slice","document","getElementById","handleResize","offsetWidth","scrollWidth","offsetHeight","scrollHeight","window","addEventListener","removeEventListener","id","ScaledImage","onload","rescaledHole","useStyles","makeStyles","theme","masonry","display","marginLeft","masonryColumn","paddingLeft","masonryCell","marginTop","position","palette","action","hoverOpacity","DetailSelection","input","setInput","detailList","setDetailList","endDetailSearch","classes","detailImage","setDetailImage","cloneSelections","deleteDetailItem","item","type","payload","selector","allImages","datum","deleteFunc","length","d","undefined","concat","map","selectionsChomp","stack","current","Grid","xs","Typography","variant","url","newSelection","newCurrent","newStack","Button","fullWidth","onClick","clone","aid","disabled","i","j","s1","s2","selectionsMatch","paddingTop","breakpointCols","className","columnClassName","top","right","align","BasicSearchSidebar","onNewSearch","onDetailSearch","fetching","Container","left","images","hideOverlay","countFrom","spacing","FormControl","InputLabel","Select","labelId","SearchDatum","this","c","Object","create","a","endpoint","send","resultCount","details","callback","engine","synchronous","formData","FormData","file","append","getWeights","params","URLSearchParams","location","search","has","get","xhr","XMLHttpRequest","open","initialResults","JSON","parse","responseText","filter","r","collection","getCollectionInfo","name","computeCircle","circle","center_x","center_y","rect_top","round","rect_bottom","rect_left","rect_right","sq_radius","marked","sq_x","sq_y","weights","detail","weight_encoding","Array","circleArray","columns","column","join","marginBottom","BasicSearchResults","results","setResults","tileSize","setTileSize","showLikeness","setShowLikeness","ToggleButtonGroup","exclusive","value","onChange","n","ToggleButton","borderRadius","data-tip","data-html","data-effect","data-place","fontSize","lineHeight","textTransform","IconButton","size","color","Slider","step","CircularProgress","result","ResultTile","overlay","isChecked","padding","margin","zIndex","heatmapurl","Card","borderColor","CardContent","justify","Checkbox","checked","paddingRight","BasicSearch","update","setFetching","getSimilar","parseInt","useReducer","oldResults","newResult","Error","oldDetailList","newDetail","splice","warn","detailSearch","setDetailSearch","uploadText","textAlign","inputZone","border","boxSizing","tile","Start","count","forcedImages","split","isNaN","response","randomImages","tooltip_pos","updateFileInput","Promise","resolve","reader","FileReader","target","readAsDataURL","DndProvider","backend","HTML5Backend","paddingBottom","InputZone","onFileDrop","f","onURLDrop","u","onAssetDrop","onFileUpload","files","DecoratedDivider","GridList","cols","justifyContent","documentElement","clientWidth","asset","GridListTile","ImageTile","useDrag","drag","ref","objectFit","useDrop","accept","NativeTypes","FILE","URL","drop","monitor","getItemType","getItem","urls","ext","substring","lastIndexOf","flexDirection","children","alignItems","defaultBlack","selectionTextColor","selectionColor","defaultBorder","defaultRadius","createMuiTheme","typography","fontFamily","fontWeightRegular","h1","h2","fontWeight","h3","button","primary","main","text","overrides","MuiButton","root","backgroundColor","MuiToggleButton","fade","MuiSelect","MuiCheckbox","colorSecondary","MuiSlider","MuiCircularProgress","colorPrimary","App","menuLocation","setMenuLocation","aboutOpen","setAboutOpen","ThemeProvider","AppBar","Toolbar","reload","currentTarget","anchorEl","Boolean","MenuList","onMouseLeave","MenuItem","href","Dialog","onClose","DialogTitle","DialogContent","DialogContentText","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode"],"mappings":"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","file":"static/js/main.6ba9f09b.chunk.js","sourcesContent":["/* Derived from src/avatar.jsx, in master branch of\n    https://github.com/kirill3333/react-avatar.git, commit\n    60d7a5f728ce276d9cbe84f1773ebf32abddf995.\n * avatar.jsx copyright (c) 2017 Kirill Novikov, MIT license\n * All changes copyright (c) 2021 Crown Copyright (The National Archives), MIT license\n * For MIT license, see https://github.com/tanc-ahrc/deep-discoveries-interface-building-blocks/blob/master/LICENSE.\n */\n\nimport React from 'react'\nimport { useState, useEffect } from 'react';\nimport Konva from 'konva/lib/Core';\nimport 'konva/lib/shapes/Image';\nimport 'konva/lib/shapes/Rect';\nimport 'konva/lib/shapes/Circle';\n\nexport default function DetailSelector({src, shadingColor, shadingOpacity, selections, setSelections, ...props}) {\n  const containerId = 'imageviewer_component';\n  const [image] = useState(new Image());\n  image.src = src;\n  const [width, setWidth] = useState(image.naturalWidth);\n  const [height, setHeight] = useState(image.naturalHeight);\n\n  React.useEffect(() => {\n    // Scale to the smaller dimension\n    let widthScale = width / image.naturalWidth;\n    let heightScale = height / image.naturalHeight;\n    const scale = widthScale < heightScale ? widthScale : heightScale;\n\n    // Base selector size on the smaller factor. Magic constant arrived at by trial and error.\n    const selectorSize = widthScale < heightScale ? image.naturalWidth  * scale * 0.025 * 0.5\n                                                  : image.naturalHeight * scale * 0.025 * 0.5;\n\n    const newSelections = [];\n\n    // TODO: Could make more sense to create a subclass of Rect.\n    //       This would handle the boilerplate repetition in the\n    //       event handlers.\n    function initHole(x, y, opacity) {\n      return new Konva.Circle({\n        x: x,\n        y: y,\n        radius: selectorSize * 2,\n        fillPatternImage: image,\n        fillPatternOffset: { x: x, y: y },\n        fillPatternScale: { x: scale, y: scale },\n        opacity: opacity\n      });\n    }\n\n    const stage = new Konva.Stage({\n      container: containerId,\n      width: image.naturalWidth * scale,\n      height: image.naturalHeight * scale\n    });\n\n    const background = new Konva.Image({\n      x: 0,\n      y: 0,\n      width: image.naturalWidth * scale,\n      height: image.naturalHeight * scale,\n      image: image\n    });\n\n    const shading = new Konva.Rect({\n      x: 0,\n      y: 0,\n      width: background.width(),\n      height: background.height(),\n      fill: shadingColor,\n      strokeWidth: 0,\n      opacity: shadingOpacity,\n      visible: true\n    });\n\n    const select = initHole(0, 0, 1);\n    select.visible(false);\n    select.draggable(true);\n    select.stroke('white');\n    select.strokeWidth(1);\n    //TODO: May want to fiddle the size of select so that the part covered\n    //      by the stroke is not included in the selection.\n\n    const layer = new Konva.Layer();\n    layer.add(background);\n    layer.add(shading);\n    layer.add(select);\n    stage.add(layer);\n\n    selections.forEach((selection) => {\n      selection.forEach((hole) => {\n        const holeScale = hole.fillPatternScaleX();\n        if(holeScale !== hole.fillPatternScaleY()) console.error('Inconsistent scale');\n\n        const scaledX = Math.max(Math.min(scale * (hole.x() / holeScale), image.width * scale - 1), 0);\n        const scaledY = Math.max(Math.min(scale * (hole.y() / holeScale), image.height * scale - 1), 0);\n        const scaledRadius = Math.max(scale * hole.radius() / holeScale, 1);\n        hole.x(scaledX);\n        hole.y(scaledY);\n        hole.radius(scaledRadius);\n        hole.fillPatternOffset({ x: scaledX, y: scaledY });\n        hole.fillPatternScale({ x: scale, y: scale});\n\n        layer.add(hole);\n      });\n    });\n\n    stage.on(\"mouseenter\", (e) => {\n      select.visible(true);\n      stage.container().style.cursor = 'none';\n    });\n\n    stage.on(\"mouseleave\", (e) => {\n      select.visible(false);\n      stage.container().style.cursor = 'default';\n      layer.draw();\n    });\n\n    stage.on(\"mousemove\", (e) => {\n      const x = e.evt.layerX - selectorSize;\n      const y = e.evt.layerY - selectorSize;\n      select.x(x);\n      select.y(y);\n      select.fillPatternOffset({x: x, y: y});\n      layer.batchDraw();\n    });\n\n    stage.on(\"mousedown dragmove\", (e) => {\n      const x = e.evt.layerX - selectorSize;\n      const y = e.evt.layerY - selectorSize;\n      const hole = initHole(x, y, 1);\n      layer.add(hole);\n      newSelections.push(hole);\n      layer.batchDraw();\n    });\n\n    stage.on(\"mouseup dragend dragleave dragexit\", () => {\n      const s = selections.slice();\n      s.push(newSelections);\n      setSelections(s);\n    });\n\n    layer.draw();\n  }, [width, height, shadingColor, shadingOpacity, image, selections, setSelections]);\n\n  /* Resizing tricks following https://www.pluralsight.com/guides/re-render-react-component-on-window-resize */\n  useEffect(\n    () => {\n      const e = document.getElementById(containerId);\n      function handleResize() {\n        // -1 here to avoid infinite loops when the width is fractionally smaller than the offsetWidth\n        if(width < e.offsetWidth - 1 ||      // make the image bigger if it is not using all the space\n          e.offsetWidth < e.scrollWidth) {   // make the image smaller if it is using too much space\n          setWidth(e.offsetWidth);\n        }\n\n        // -1 here to avoid infinite loops when the height is fractionally smaller than the offsetHeight\n        if(height < e.offsetHeight - 1 ||    // make the image bigger if it is not using all the space\n          e.offsetHeight < e.scrollHeight) { // make the image smaller if it is using too much space\n          setHeight(e.offsetHeight);\n        }\n      }\n      handleResize(); //ensure that we are sized correctly\n      window.addEventListener('resize', handleResize);\n\n      return () => {\n        window.removeEventListener('resize', handleResize);\n      }\n    },\n    [image, width, height]\n  );\n\n  return (\n    <div>\n      <div id={containerId} {...props}/>\n    </div>\n  );\n}\n","import { useState, useEffect } from 'react';\nimport Konva from 'konva/lib/Core';\nimport 'konva/lib/shapes/Image';\n\n/* Derived from src/avatar.jsx, in master branch of\n    https://github.com/kirill3333/react-avatar.git, commit\n    60d7a5f728ce276d9cbe84f1773ebf32abddf995.\n * avatar.jsx copyright (c) 2017 Kirill Novikov, MIT license\n * All changes copyright (c) 2021 Crown Copyright (The National Archives), MIT license\n * For MIT license, see https://github.com/tanc-ahrc/deep-discoveries-interface-building-blocks/blob/master/LICENSE.\n */\nexport default function ScaledImage({id, src, shadingColor, shadingOpacity, selections, ...props}) {\n  const containerId = 'ScaledImage_' + id;\n  const [width, setWidth] = useState(0);\n  const [image] = useState(new Image());\n  image.src = src;\n\n  useEffect(\n    /* Resizing tricks following\n     * www.pluralsight.com/guides/re-render-react-component-on-window-resize\n     */\n    () => {\n      const e = document.getElementById(containerId);\n      function handleResize() {\n        if(image.width !== e.offsetWidth || e.offsetWidth !== e.scrollWidth) {\n          setWidth(e.offsetWidth);\n        }\n      }\n      handleResize(); //ensure that we are sized correctly\n      window.addEventListener('resize', handleResize);\n\n      image.onload = () => {\n        const scale = width / image.width;\n        const stage = new Konva.Stage({\n          container: containerId,\n          width: width,\n          height: image.height * scale,\n        });\n        const background = new Konva.Image({\n          x: 0,\n          y: 0,\n          width: image.width * scale,\n          height: image.height * scale,\n          image: image,\n        });\n        const shading = new Konva.Rect({\n          x: 0,\n          y: 0,\n          width: background.width(),\n          height: background.height(),\n          fill: shadingColor,\n          strokeWidth: 0,\n          opacity: shadingOpacity,\n          visible: true\n        });\n\n        const layer = new Konva.Layer();\n        layer.add(background);\n        layer.add(shading);\n\n        function rescaledHole(hole) {\n          const holeScale = hole.fillPatternScaleX();\n          if(holeScale !== hole.fillPatternScaleY()) console.error('Inconsistent scale');\n\n          const scaledX = Math.max(Math.min(scale * (hole.x() / holeScale), image.width * scale - 1), 0);\n          const scaledY = Math.max(Math.min(scale * (hole.y() / holeScale), image.height * scale - 1), 0);\n          const scaledRadius = Math.max(scale * hole.radius() / holeScale, 1);\n          return new Konva.Circle({\n            x: scaledX,\n            y: scaledY,\n            radius: scaledRadius,\n            fillPatternImage: hole.fillPatternImage(),\n            fillPatternOffset: { x: scaledX, y: scaledY },\n            fillPatternScale: { x: scale, y: scale },\n            opacity: hole.opacity()\n          });\n        }\n\n        selections.forEach((selection) => {\n          selection.forEach((hole) => {\n            layer.add(rescaledHole(hole));\n          });\n        });\n\n        stage.add(layer);\n        layer.draw();\n      };\n\n      return () => {\n        window.removeEventListener('resize', handleResize);\n      }\n    }, [containerId, image, width, shadingColor, shadingOpacity, selections]);\n\n    return (<div id={containerId} {...props}/>);\n}\n","//TODO: The {stack, current} entity should really be\n//      a proper class with its own methods, rather\n//      than being externally manipulated all over\n//      the place.\n\nimport Grid from '@material-ui/core/Grid';\nimport Typography from '@material-ui/core/Typography';\nimport Button from '@material-ui/core/Button';\nimport { makeStyles} from '@material-ui/core/styles';\nimport { useState } from 'react';\nimport Masonry from 'react-masonry-css';\nimport DetailSelector from './DetailSelector.js';\nimport ScaledImage from './ScaledImage.js';\nimport CancelIcon from '@material-ui/icons/Cancel';\n\nconst useStyles = makeStyles((theme) => ({\n  masonry: {\n    display: 'flex',\n    marginLeft: '-10px',\n  },\n  masonryColumn: {\n    paddingLeft: '10px',\n  },\n  masonryCell: {\n    marginTop: '10px',\n    position: 'relative',\n    '&:hover': {\n      cursor: 'pointer',\n      opacity: theme.palette.action.hoverOpacity,\n    },\n  },\n}));\n\nexport default function DetailSelection({input, setInput, detailList, setDetailList, endDetailSearch}) {\n  const classes = useStyles();\n\n  const [detailImage, setDetailImage] = useState(input)\n  const [selections, setSelections] = useState(input.cloneSelections());\n\n  const shadingColor='black'\n  const shadingOpacity=0.5\n\n  function pushSelection(newSelection) {\n    const newCurrent = selections.current + 1;\n    const newStack = selections.stack.slice(0, newCurrent);\n    newStack.push(newSelection);\n    setSelections({stack: newStack, current: newCurrent});\n  }\n  function undo() { setSelections({stack: selections.stack, current: selections.current - 1}); }\n  function redo() { setSelections({stack: selections.stack, current: selections.current + 1}); }\n  function clear(){ setSelections({stack: [[]], current: 0}); }\n\n  //Item is a dummy parameter. Both funcs must have the same signature\n  //See CancelIcon's onClick, where they are used.\n  function deleteInput(item) {\n    if(detailList.length !== 0) {\n      const d = detailList[0];\n      setDetailList({type: 'remove', payload: d});\n      setInput(d);\n    }\n    else setInput(undefined);\n  }\n\n  function deleteDetailItem(item) {\n    setDetailList({type: 'remove', payload: item});\n  }\n\n  const allImages = [{datum: input, deleteFunc: deleteInput}].concat(detailList.map((d) => { return { datum: d, deleteFunc: deleteDetailItem};}));\n\n  let selector;\n  if(typeof detailImage !== typeof undefined) {\n    function selectionsChomp() {\n      return {\n        stack: selections.stack.slice(0, selections.current + 1),\n        current: selections.current,\n      };\n    }\n\n    function selectionsMatch() {\n      const s = selectionsChomp();\n      if(s.stack.length !== detailImage.selections.stack.length) return false;\n      if(s.current !== detailImage.selections.current) return false;\n      for(let i = 0; i < s.stack.length; i++) {\n        if(s.stack[i].length !== detailImage.selections.stack[i].length) return false;\n      }\n      for(let i = 0; i < s.stack.length; i++) {\n        for(let j = 0; j < s.stack[i].length; j++) {\n          const s1 = s.stack[i][j];\n          const s2 = detailImage.selections.stack[i][j];\n          if(s1.radius !== s2.radius) return false;\n          if(s1.x !== s2.x) return false;\n          if(s1.y !== s2.y) return false;\n        }\n      }\n      return true;\n    }\n\n    selector = (\n      <>\n        <Grid item xs={12}>\n          <Typography variant='h3'>Click and draw over the image to highlight areas of interest.</Typography>\n        </Grid>\n        <Grid item xs={10}>\n          <DetailSelector src={detailImage.url}\n                          shadingColor={shadingColor}\n                          shadingOpacity={shadingOpacity}\n                          selections={selections.stack[selections.current]}\n                          setSelections={pushSelection}/>\n        </Grid>\n        <Grid container item xs={2}>\n          <Grid item xs={11}>\n            <Button fullWidth={true} onClick={()=>{\n                      const d = detailImage.clone();\n                      d.selections = selectionsChomp();\n                      if(d.aid === input.aid) { setInput(d); }\n                      else { setDetailList({type: 'update', payload: d}); }\n                      setDetailImage(undefined); /* Workaround: without this, we fill new selections in one image with the background image from the next image. TODO: fix said bug.*/\n                    }}\n                    disabled={selectionsMatch()}\n            >Update selections</Button>\n            <div style={{paddingTop: '2vh'}}/>\n            <Button fullWidth={true} disabled={selections.current === 0}                           onClick={undo}>Undo</Button>\n            <Button fullWidth={true} disabled={selections.current === selections.stack.length - 1} onClick={redo}>Redo</Button>\n            <Button fullWidth={true} disabled={selections.current === 0} onClick={clear}>Clear</Button>\n          </Grid>\n        </Grid>\n      </>\n    );\n  }\n\n  return (\n    <Grid container>\n      <Grid container>\n        <Grid container item xs={4}>\n          <Grid item xs={12}>\n            <Button onClick={endDetailSearch}>Back to results</Button>\n          </Grid>\n          <Grid item xs={12}>\n            <Masonry\n              breakpointCols={2}\n              className={classes.masonry}\n              columnClassName={classes.masonryColumn}\n            >\n              {allImages.map((image) => (\n                <div className={classes.masonryCell} key={image.datum.aid}>\n                  <ScaledImage id={image.datum.aid}\n                               src={image.datum.url}\n                               shadingColor={shadingColor}\n                               shadingOpacity={image.datum.selections.current === 0 ? 0 : shadingOpacity}\n                               selections={image.datum.selections.stack[image.datum.selections.current]}\n                               onClick={()=>{setSelections(image.datum.cloneSelections()); setDetailImage(image.datum);}}\n                  />\n                  <CancelIcon\n                    style={{position: 'absolute', top: 0, right: 0}}\n                    onClick={ () => { image.deleteFunc(image.datum) }}\n                  />\n                </div>\n              ))}\n            </Masonry>\n          </Grid>\n        </Grid>\n        <Grid container item xs={8} align='right'>\n          {selector}\n        </Grid>\n      </Grid>\n    </Grid>\n  );\n}\n","import Container from '@material-ui/core/Container';\nimport Grid from '@material-ui/core/Grid';\nimport Button from '@material-ui/core/Button';\nimport Select from '@material-ui/core/Select';\nimport InputLabel from '@material-ui/core/InputLabel';\nimport FormControl from '@material-ui/core/FormControl';\nimport FbImageLibrary from 'react-fb-image-grid';\n\nexport default function BasicSearchSidebar({input, detailList, onNewSearch, onDetailSearch, fetching}) {\n  return (\n    <Container>\n      <div style={{position: 'relative', top: 0, left: 0}}>\n        <FbImageLibrary\n          images={[input.url].concat(detailList.map(d => d.url))}\n          hideOverlay={true}\n          countFrom={4}\n        />\n      </div>\n      <Grid container style={{paddingTop: '3vh'}} spacing={2}>\n        <Grid item xs={6}>\n          <Button fullWidth={true} disabled={fetching} onClick={onNewSearch}>Update search</Button>\n        </Grid>\n        <Grid item xs={6} align='right'>\n          <Button fullWidth={true} disabled={fetching} onClick={onDetailSearch}>Edit search</Button>\n        </Grid>\n      </Grid>\n      <div style={{paddingTop: '6vh'}}/>\n      <FormControl fullWidth={true}>\n        <InputLabel id='recentSearchesLabel'>&nbsp;Recent searches</InputLabel>\n        <Select labelId='recentSearchesLabel' disabled={fetching}>\n          <option>Placeholder recent 1</option>\n          <option>Placeholder recent 2</option>\n        </Select>\n      </FormControl>\n      <div style={{paddingTop: '1vh'}}/>\n      <FormControl fullWidth={true}>\n        <InputLabel id='savedCollectionsLabel'>&nbsp;Saved collections</InputLabel>\n        <Select labelId='savedCollectionsLabel' disabled={fetching}>\n          <option>Placeholder saved 1</option>\n          <option>Placeholder saved 2</option>\n        </Select>\n      </FormControl>\n    </Container>\n  );\n}\n","export default class SearchDatum {\n  constructor(aid, url) {\n    this.aid = aid; //TODO: This should be called 'id', and just happens to be set to 'aid' for results from the server\n    this.url = url;\n    this.selections = {\n      stack: [[]],\n      current: 0,\n    };\n  }\n\n  clone() {\n    const c = Object.create(this);\n    c.selections = this.cloneSelections();\n    return c;\n  }\n\n  cloneSelections() {\n    return {\n      stack: this.selections.stack.map((a) => { return a.slice(); }),\n      current: this.selections.current,\n    };\n  }\n}\n","import SearchDatum from './SearchDatum.js';\n\nconst endpoint = 'https://decade.ac.uk/deepdiscovery/api/upload';\n\nexport function send(input, resultCount, details, callback, engine = 'Style', synchronous = false) {\n  const formData = new FormData();\n  if(input) {\n    if     (input.file) formData.append('query_file', input.file);\n    else if(input.aid)  formData.append('query_aid',  input.aid);\n    else                formData.append('query_url',  input.url);\n  }\n  formData.append('searchengine', engine);\n  formData.append('resultcount', resultCount);\n  if(details) formData.append('weights', getWeights(details));\n  const params = new URLSearchParams(window.location.search);\n  formData.append('weightfactor', params.has('w') ? params.get('w') : 10);\n\n  const xhr = new XMLHttpRequest();\n  xhr.open('POST', endpoint, !synchronous);\n  xhr.onload = function() {\n    let initialResults = JSON.parse(this.responseText);\n    initialResults = initialResults.filter((r) => {\n      return r.collection != null && getCollectionInfo(r.collection).name != null;\n    });\n    callback(initialResults);\n  };\n  xhr.send(formData);\n}\n\nexport function randomImages(count) {\n  let result;\n  const params = new URLSearchParams(window.location.search);\n  const forcedImages = [];\n  if(params.has('f')) {\n    for(const f of params.get('f').split(';')) {\n      let [aid, collection] = f.split(',');\n      let url;\n      if(isNaN(aid)) { //aid is not a number: assume it is a URL\n        url = aid;\n        aid = 0;\n      }\n      else { //aid is a number: assume it is actually an aid and construct the URL\n        url = 'https://s3.eu-west-2.amazonaws.com/deepdiscovery.thumbnails/' + collection + '/' + aid + '.jpg';\n      }\n      const r = new SearchDatum(aid, url);\n      r.collection = collection; //This only works if we are given a collection that getCollectionInfo will accept. TODO: Add a 'none' collection option.\n      forcedImages.push(r);\n    }\n  }\n  send(null, count - forcedImages.length, null, (response) => {\n    result = response;\n  }, 'Random', true);\n  return forcedImages.concat(result);\n}\n\nexport function getCollectionInfo(collection) {\n  if(collection == null) return null; /* matches on undefined or null */\n\n  let c = { id: collection };\n\n  if     (collection === \"RGBE\")   c.name = \"Royal Botanic Garden Edinburgh\";\n  else if(collection === \"TNA1\" ||\n          collection === \"TNA2\" ||\n          collection === \"TNA3\")   c.name = \"The National Archives\";\n  else if(collection === \"VA1\" ||\n          collection === \"VA2\")    c.name = \"Victoria & Albert Museum\";\n  else                             c.name = null;\n\n  return c;\n}\n\nfunction computeCircle(circle, map) {\n  const scale = circle.fillPatternScaleX();\n  if(scale !== circle.fillPatternScaleY()) {\n    console.error('Inconsistent scale');\n    //This is a Bad Thing as it means that the radius warps differently\n    //in each dimension, which'll make computing the selected pixels more\n    //tricky. We maintain aspect ratio when we scale images, so\n    //it should not happen. (And in an ideal world, we'd generate a png of\n    //the selections, so we would not need to do any of this calculation\n    //at all.)\n  }\n  const center_x = Math.max(Math.min(circle.x() / scale, map.length - 1), 0)\n  const center_y = Math.max(Math.min(circle.y() / scale, map[0].length - 1), 0)\n  const radius = circle.radius() / scale;\n\n  //following https://stackoverflow.com/a/14487680\n  const rect_top =    Math.max(Math.round(center_y - radius), 0);\n  const rect_bottom = Math.min(Math.round(center_y + radius), map[0].length - 1);\n  const rect_left =   Math.max(Math.round(center_x - radius), 0);\n  const rect_right =  Math.min(Math.round(center_x + radius), map.length - 1);\n  const sq_radius =   Math.round(radius * radius);\n  let marked = false;\n  for(let x = rect_left; x <= rect_right; x++) {\n    for(let y = rect_top; y <= rect_bottom; y++) {\n      let sq_x = (x - center_x); sq_x = sq_x * sq_x;\n      let sq_y = (y - center_y); sq_y = sq_y * sq_y;\n      if(sq_x + sq_y < sq_radius) {\n        marked = true;\n        map[x][y] = 1;\n      }\n    }\n  }\n\n  //If we did not mark anything at all, at least\n  //mark the centre of the circle. This can happen\n  //if a small image is drawn upon while very enlarged.\n  if(!marked) map[Math.round(center_x)][Math.round(center_y)] = 1;\n}\n\nfunction getWeights(detailList) {\n  const weights = [];\n  for(const detail of detailList) {\n    const image = new Image();\n    image.src = detail.url;\n    let weight_encoding = '' + detail.aid + '*' + image.naturalWidth + '*' + image.naturalHeight + '*';\n    const map = new Array(image.naturalWidth);\n    for(let i = 0; i < map.length; i++) {\n      map[i] = new Array(image.naturalHeight);\n    }\n    if(detail.selections.stack[detail.selections.current].length === 0) {\n      for(let i = 0; i < map.length; i++) {\n        map[i].fill(1);\n      }\n    }\n    else {\n      for(let i = 0; i < map.length; i++) {\n        map[i].fill(0);\n      }\n      for(const circleArray of detail.selections.stack[detail.selections.current]) {\n        for(const circle of circleArray) {\n          computeCircle(circle, map);\n        }\n      }\n    }\n    const columns = [];\n    for(let y = 0; y < image.naturalHeight; y++) {\n      let column = '';\n      for(let x = 0; x < image.naturalWidth; x++) {\n        column += map[x][y];\n      }\n      columns.push(column);\n    }\n    //uncomment next line to dump encodings to console\n    //helpful when testing that the encodings are working with testimage.py\n    //console.log(weight_encoding + columns.join(''));\n    weights.push(weight_encoding + columns.join(''));\n  }\n  return weights.join('');\n}\n","import Container from '@material-ui/core/Container';\nimport Typography from '@material-ui/core/Typography';\nimport Grid from '@material-ui/core/Grid';\nimport ToggleButtonGroup from '@material-ui/lab/ToggleButtonGroup';\nimport ToggleButton from '@material-ui/lab/ToggleButton';\nimport IconButton from '@material-ui/core/IconButton';\nimport Slider from '@material-ui/core/Slider';\nimport Card from '@material-ui/core/Card';\nimport CardContent from '@material-ui/core/CardContent';\nimport Checkbox from '@material-ui/core/Checkbox';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { useState } from 'react';\nimport ReactTooltip from 'react-tooltip';\nimport AddCircleOutlineOutlinedIcon from '@material-ui/icons/AddCircleOutlineOutlined';\nimport RemoveCircleOutlineOutlinedIcon from '@material-ui/icons/RemoveCircleOutlineOutlined';\nimport Masonry from 'react-masonry-css';\nimport { getCollectionInfo } from './Backend.js';\n\nconst useStyles = makeStyles((theme) => ({\n  masonry: {\n    display: 'flex',\n    marginLeft: '-10px',\n  },\n  masonryColumn: {\n    paddingLeft: '10px',\n  },\n  masonryCell: {\n    marginBottom: '10px',\n  },\n}));\n\nexport default function BasicSearchResults({input, results, setResults, detailList, setDetailList, fetching}) {\n  const classes = useStyles();\n\n  const [tileSize, setTileSize] = useState(2);\n  const [showLikeness, setShowLikeness] = useState(false);\n\n  const likenessTip = '<div><p align=\"center\">Areas of the image that are recognised as most or least alike. The left side (blue) is least alike. The right side (red) is most alike.</p><svg version=\"1.1\" id=\"Layer_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\" width=\"245px\" height=\"24px\" viewBox=\"0 0 245 24\" enable-background=\"new 0 0 245 24\" xml:space=\"preserve\">  <image id=\"image0\" width=\"245\" height=\"24\" x=\"0\" y=\"0\" href=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPUAAAAYCAMAAAAVtUsLAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAC4lBMVEUAAIEAAIQAAIcAAI0AAJEAAJUBAJoAAJ0AAKIAAKYAAKsAAK8AALQAALcAALsAAL8AAMIAAMUAAMsAANAAANQBANgAANwAAOAAAOQAAOgAAO0AAPMAAPYAAPkAAvwABP4ACP8ADP8AEP4AFP4AGf8AHf8AIf8AJv8AKf8ALf4AMf4ANf4AOf4AP/4AQv8AR/8AS/8AT/8AVP8AV/4AW/4AX/8AZP8BZ/8AbP8AcP4AdP4AeP8Ae/4Af/4AhP4BiP8Ai/8Akf8Alf8AmP4Anf8Aof8Apf8Aqf8Arv4Asf4Btv8Buf8Avf8Awv8Axf8Ayv8Azv8A0/8A1/8A2/4A4f8A5P8A5/8A6/8A8P4A8/4B+P8C/P4D/vsH//gK//QO//AS/+0X/+gb/+Mf/98i/94n/9ks/9Mw/s82/so5/8c9/8JB/75F/7lH/7dM/7NR/61V/6lZ/6Rd/6Fh/55l/5tq/5Vu/5Fz/4x4/4d7/oR+/3+B/3uE/3eI/3WO/3CS/2yX/2ec/2Of/2Cj/1um/1ir/1Sw/1C1/0u3/0e8/0PA/z7E/zrI/zfL/zPQ/y7U/yrZ/yXd/yLh/x7l/xnp/xXu/xHy/gz3/gn7/gb+/QT/+wH/9gD+8gD/7gD+6QD+5gD/4gD/3gD+2QD/1gD/0QD/zAH/yAH/xAH+wAD/vAD/uAD+tAD+sQD+rAD/pwH/owH/nwH/mwD/lgD/kgD/jgH/igH/hgH/gQD/fgD/egD/dwD/cgD/bgD/aQD/ZgD/YQD/XQD+WQD+VQD+UQH/TAH/SAH/RAD/QQD/PAD/OAD/NAD/MQD+LAD+JwD/JAH+HwD+HAD/FwD/EgH/DgH/CwH/BwD+AwD7AQD4AAD1AADxAADqAADnAADiAADfAQDaAADWAADSAADOAQDJAQHEAQLBAAG9AAC5AAC2AQCzAACtAACpAAClAACgAQGdAACXAACUAACQAAGMAAGIAACFAAD///+0LjPXAAAAAWJLR0T1RdIb2wAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB+UFHBIeAwqYXr0AAAFASURBVFjDY2BgZGJmYWVj5+Dk4ubh5eMXEBQSFhEVE5eQlJKWkZWTV1BUUlZRVVPX0NTS1tHV0zcwNDI2MTUzt7C0sraxtbN3cHRydnF1c/fw9PL28fXzDwgMCg4JDQuPiIyKjomNi09ITEpOSU1Lz8jMys7JzcsvKCwqLiktK6+orKquqa2rb2hsam5pbWvv6Ozq7unt658wcdLkKVOnTZ8xc9bsOXPnzV+wcNHiJUuXLV+xctXqNWvXrd+wcdPmLVu3bd+xc9fuPXv37T9w8NDhI0ePHT9x8tTpM2fPnb9w8dLlK1evXb9x89btO3fv3X/w8NHjJ0+fPX/x8tXrN2/fvf/w8dPnLwyjvh719aivR3096utRX4/6etTXo74e9fWor0d9PerrUV+P+nrU16O+HvX1qK9HfT3q6xHmawBSUfLHjvdTOwAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAyMS0wNS0yOFQxNzozMDowMyswMTowMHLbfNcAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMjEtMDUtMjhUMTc6MzA6MDMrMDE6MDADhsRrAAAAAElFTkSuQmCC\"/></svg></div>'\n\n  return (\n    <Container>\n      <ReactTooltip/>\n      <Typography variant='h2' align='left'>Similar Images</Typography>\n      <Grid container>\n        <Grid item xs={6}>\n          <ToggleButtonGroup style={{width: '100%'}} exclusive value={showLikeness} onChange={(e, n)=>{if(n === true || n === false) setShowLikeness(n);}}>\n            <ToggleButton style={{borderRadius: '5px 0   0   5px', width: '50%'}} value={false} disabled={!showLikeness}>Image view</ToggleButton>\n            <ToggleButton style={{borderRadius: '0   5px 5px 0'  , width: '50%'}} value={true}  disabled={ showLikeness} data-tip={likenessTip} data-html={true} data-effect='solid' data-place='bottom'>Likeness view</ToggleButton>\n          </ToggleButtonGroup>\n        </Grid>\n        <Grid item xs={3}>\n          <div/>\n        </Grid>\n        <Grid container item xs={3}>\n          <Grid item xs={12}>\n            <Typography style={{fontSize: 12, lineHeight: 1, textTransform: 'uppercase'}}>Image Size</Typography>\n          </Grid>\n          <Grid item xs={2} align='left'>\n            {/* Using IconButton 'disabled' can result in conditions where the images constantly switch\n              * between two sizes until the user clicks anywhere in the page, or the page crashes. */}\n            {/*disabled={tileSize === 1}*/}\n            <IconButton\n              size='small'\n              color='primary'\n              disabled={fetching}\n              onClick={() => setTileSize(tileSize => tileSize > 1 ? tileSize - 1 : tileSize)}>\n              <RemoveCircleOutlineOutlinedIcon/>\n            </IconButton>\n          </Grid>\n          <Grid item xs={8}>\n            <Slider\n              value={tileSize}\n              disabled={fetching}\n              onChange={ (e, x) => { setTileSize(x); } }\n              step={1}\n              min={1}\n              max={3}\n            />\n          </Grid>\n          <Grid item xs={2} align='right'>\n            <IconButton\n              size='small'\n              color='primary'\n              disabled={fetching}\n              onClick={() => setTileSize(tileSize => tileSize < 3 ? tileSize + 1 : tileSize)}>\n              <AddCircleOutlineOutlinedIcon/>\n            </IconButton>\n          </Grid>\n        </Grid>\n      </Grid>\n      {fetching ?\n        <CircularProgress style={{marginTop: '3vh', height: '50vh', width: '50vh'}}/>\n      :\n        <Masonry breakpointCols={5 - tileSize}\n                 className={classes.masonry}\n                 columnClassName={classes.masonryColumn}\n                 style={{paddingTop: '3vh'}}>\n          {results.map((result) => (\n            <ResultTile className={classes.masonryCell} key={result.aid} result={result} detailList={detailList} setDetailList={setDetailList} showLikeness={showLikeness} tileSize={tileSize}/>\n          ))}\n        </Masonry>\n      }\n    </Container>\n  );\n}\n\nfunction ResultTile({result, detailList, setDetailList, tileSize, showLikeness, ...props}) {\n  let isChecked = false;\n  for(const detail of detailList) {\n    if(result.aid === detail.aid) {\n      isChecked = true;\n      break;\n    }\n  }\n\n  // Pointer to a transparent png, for testing this:\n  // result.likeness = 'https://onlinepngtools.com/images/examples-onlinepngtools/clouds-transparent.png';\n  let overlay;\n  if(showLikeness) overlay = (\n    <img style={{height: '100%', width: '100%', padding: 0, margin: 0, position: 'absolute', top: 0, left: 0, zIndex: 2}}\n         src={result.heatmapurl}/>\n  );\n\n  return (\n    <Card {...props} variant='outlined' style={{borderColor:'#292929', borderRadius: '5px 5px 0 0'}}>\n      <CardContent style={{margin: 0, padding: 0}}>\n        <Grid container justify='space-between'>\n          <Grid item>\n            <Checkbox style={{margin: 0, padding: 0}}\n                      checked={isChecked}\n                      onChange={() => { setDetailList({type: isChecked ? 'remove' : 'add', payload: result.clone()}); }}\n            />\n          </Grid>\n          <Grid item><Typography style={{paddingRight: '3px'}}>{getCollectionInfo(result.collection).name}</Typography></Grid>\n        </Grid>\n        <div style={{position: 'relative', top: 0, left: 0}}>\n          <img style={{height: '100%', width: '100%', padding: 0, margin: 0, position: 'relative', top: 0, left: 0, zIndex: 1}} src={result.url}/>\n          {overlay}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","import Grid from '@material-ui/core/Grid';\nimport { useState, useReducer } from 'react';\nimport DetailSelection from './DetailSelection.js';\nimport BasicSearchSidebar from './BasicSearchSidebar.js';\nimport BasicSearchResults from './BasicSearchResults.js';\nimport SearchDatum from './SearchDatum.js';\nimport { send } from './Backend.js';\n\nexport default function BasicSearch({input, setInput, update}) {\n  const [fetching, setFetching] = useState(false);\n\n  function getSimilar() {\n    if(fetching) return;\n    setFetching(true);\n    send(input, 33, [input].concat(detailList), (initialResults) => {\n      //If the input was an asset, do not display it in the results\n      //TODO: We should shortcircuit. Or, probably, it is safe just to shift the first element off.\n      if(input.aid) initialResults = initialResults.filter((r) => { return r.aid !== parseInt(input.aid); });\n\n      setResults({type: 'replace', payload: initialResults.map((x) => {\n        const y = new SearchDatum(x.aid, x.url);\n        y.collection = x.collection;\n        y.heatmapurl = x.heatmapurl;\n        return y;\n      })});\n    });\n  }\n\n  const [results, setResults] = useReducer(\n    (oldResults, action) => {\n      const newResult = action.payload;\n      setFetching(false);\n      switch(action.type) {\n        case 'replace': { return newResult; }\n        case 'update':  { return oldResults.map((r) => { return r.aid === newResult.aid ? newResult : r; }); }\n        default:        throw new Error();\n      }\n    },\n    []\n  );\n  const [detailList, setDetailList] = useReducer(\n    (oldDetailList, action) => {\n      const newDetail = action.payload;\n      switch(action.type) {\n        case 'add': {\n          return oldDetailList.concat(newDetail);\n        }\n        case 'remove': {\n          for(let i = 0; i < oldDetailList.length; i++) {\n            if(newDetail.aid === oldDetailList[i].aid) {\n              oldDetailList.splice(i, 1);\n              return oldDetailList.slice();\n            }\n          }\n\n          //TODO: This function gets called twice when we hit the checkbox, so we always see this\n          //      warning. We must return a clone of the list in this case: even though it has not\n          //      changed, the checkbox will not get cleared unless we make it look like it has.\n          console.warn('Attempted to remove non-member from detailList', newDetail, oldDetailList);\n          return oldDetailList.slice();\n        }\n        case 'update': {\n          return oldDetailList.map((d) => { return d.aid === newDetail.aid ? newDetail: d; });\n        }\n        default: throw new Error();\n      }\n    },\n    []\n  );\n  const [detailSearch, setDetailSearch] = useState(false);\n\n  if(results.length === 0) getSimilar();\n\n  if(detailSearch) {\n    return (\n      <DetailSelection input={input}\n                       setInput={setInput}\n                       results={results}\n                       setResults={setResults}\n                       detailList={detailList}\n                       setDetailList={setDetailList}\n                       endDetailSearch={() => {setDetailSearch(false); getSimilar();}}\n      />\n    )\n  }\n  else {\n    return (\n      <Grid container spacing={3}>\n        <Grid item xs={3}>\n          <BasicSearchSidebar input={input} detailList={detailList} onNewSearch={() => {getSimilar()}} onDetailSearch={() => {setDetailSearch(true)}} fetching={fetching}/>\n        </Grid>\n        <Grid item xs={9}>\n          <BasicSearchResults input={input} results={results} setResults={setResults} detailList={detailList} setDetailList={setDetailList} fetching={fetching}/>\n        </Grid>\n      </Grid>\n    );\n  }\n}\n","/* TODO: The functional components in here would be\n *       pulled out to separate files, in an ideal\n *       world.\n * TODO: There must be a better way to space out the\n *       Container's components than putting\n *       paddingBottom: 1rem everywhere.\n */\n\nimport GridList from '@material-ui/core/GridList';\nimport GridListTile from '@material-ui/core/GridListTile';\nimport Container from '@material-ui/core/Container';\nimport Typography from '@material-ui/core/Typography';\nimport Card from '@material-ui/core/Card';\nimport CardContent from '@material-ui/core/CardContent';\nimport { useDrop, useDrag, DndProvider } from 'react-dnd';\nimport { NativeTypes, HTML5Backend } from 'react-dnd-html5-backend';\nimport ReactTooltip from 'react-tooltip';\nimport { useState } from 'react';\nimport { makeStyles } from '@material-ui/core/styles';\nimport BasicSearch from './BasicSearch.js';\nimport SearchDatum from './SearchDatum.js';\nimport {randomImages, getCollectionInfo} from './Backend.js';\n\nconst useStyles = makeStyles((theme) => ({\n  uploadText: {\n    textAlign: 'center',\n    color: '#3030EE',\n    '&:hover': {\n      color: '#3090EE',\n      cursor: 'pointer',\n    }\n  },\n  inputZone: {\n    background: '#F5F5F5',\n    border: '1px dashed #595959',\n    boxSizing: 'border-box',\n    borderRadius: '5px',\n    textAlign: 'center',\n  },\n  tile: {\n    '&:hover': {\n      opacity: theme.palette.action.hoverOpacity,\n      cursor: 'pointer',\n    },\n  },\n}));\n\nexport default function Start() {\n  const classes = useStyles();\n\n  const [input, setInput] = useState();\n  const images = randomImages(8);\n  for(let i = 0; i < 4; i++) images[i].tooltip_pos = 'top';\n  for(let i = 4; i < 8; i++) images[i].tooltip_pos = 'bottom'\n\n  //For onFileDrop and onFileUpload in the InputZone, below\n  async function updateFileInput(file) {\n    const url = await new Promise((resolve) => {\n      const reader = new FileReader();\n      reader.onload = (e) => { resolve(e.target.result); };\n      reader.readAsDataURL(file);\n    });\n    const datum = new SearchDatum(0, url);\n    datum.file = file;\n    setInput(datum);\n  }\n\n  if(typeof input === typeof undefined) {\n    return (\n      <DndProvider backend={HTML5Backend}>\n        <ReactTooltip/>\n        <Container style={{width: '50vw'}} justify='center'>\n          <Typography variant='h1' align='center'>\n            Explore our National Collection\n          </Typography>\n          <Typography style={{color: '#717171', paddingBottom: '1rem'}} align='center'>\n            Search with an image to find similar results\n          </Typography>\n          <InputZone style={{paddingBottom: '1rem'}}\n            onFileDrop   = { (f) => updateFileInput(f) }\n            onURLDrop    = { (u) => setInput(new SearchDatum(0, u)) }\n            onAssetDrop  = { (a) => setInput(new SearchDatum(a.aid, a.url)) }\n            onFileUpload = { (e) => updateFileInput(e.target.files[0]) }\n          />\n          <DecoratedDivider style={{paddingBottom: '1rem'}}>\n            <Typography>&nbsp;Or&nbsp;</Typography>\n          </DecoratedDivider>\n          <Typography style={{paddingBottom: '1rem'}} align='center'>\n            Click a sample image to try it\n          </Typography>\n\n          {/*TODO: Display properties set by trial and error. Rarely, this sizes so that I have more than 2 rows.\n                   This could surely be better, but it is plenty enough for a prototype. */}\n          <GridList cols={4} style={{justifyContent: 'center'}} spacing={document.documentElement.clientWidth * 0.01}>\n          {\n            images.map(\n              (asset) => (\n                <GridListTile key={asset.aid} style={{height: '11vw', width: '11vw'}}\n                              data-tip={getCollectionInfo(asset.collection).name} data-effect='solid' data-place={asset.tooltip_pos}>\n                  <ImageTile\n                    className={classes.tile}\n                    asset={asset}\n                    onClick={ () => setInput(new SearchDatum(asset.aid, asset.url)) }\n                  />\n                </GridListTile>\n              )\n            )\n          }\n          </GridList>\n        </Container>\n      </DndProvider>\n    )\n  }\n  else {\n    return (<BasicSearch input={input} setInput={setInput}/>);\n  }\n}\n\nfunction ImageTile({className, asset, onClick}) {\n  const [, drag] = useDrag({\n    type: 'ASSET',\n    item: {\n      asset: asset\n    }\n  });\n\n  return (\n    <img className={className} ref={drag} onClick={onClick} src={asset.url} height='100%' width='100%' style={{objectFit: 'cover'}}/>\n  );\n}\n\nfunction InputZone({style, onFileDrop, onURLDrop, onAssetDrop, onFileUpload}) {\n  const classes = useStyles();\n\n  const [, drop] = useDrop({\n    accept: [NativeTypes.FILE, NativeTypes.URL, 'ASSET'],\n    drop: (item, monitor) => {\n      if(monitor.getItemType() === NativeTypes.FILE) {\n        const files = monitor.getItem().files;\n        if(files.length !== 1) return;\n        const file = files[0];\n        if(file.type !== 'image/jpeg' && file.type !== 'image/png') return;\n        onFileDrop(file);\n      }\n      else if(monitor.getItemType() === NativeTypes.URL) {\n        const urls = monitor.getItem().urls;\n        if(urls.length !== 1) return;\n        const url = urls[0]\n        const ext = url.substring(url.lastIndexOf('.') + 1);\n        if(ext !== \"jpg\" &&\n           ext !== \"jpeg\" &&\n           ext !== \"png\") return;\n        onURLDrop(url);\n      }\n      else if(monitor.getItemType() === 'ASSET') {\n        const asset = monitor.getItem().asset;\n        onAssetDrop(asset);\n      }\n    },\n  });\n\n  //Following https://stackoverflow.com/a/25825731 for the file input trick \n  //Following https://stackoverflow.com/a/56342694 for the text alignment (CardContent style)\n  return(\n    <div ref={drop} style={style}>\n      <Card className={classes.inputZone}>\n        <CardContent style={{height: '30vh', display: 'flex', flexDirection: 'column', justifyContent: 'center'}}>\n          <Typography>\n            Drag an image here or\n            <label className={classes.uploadText}>\n              <input style={{display: 'none'}}\n                     type='file'\n                     accept='image/jpeg,image/png'\n                     onChange={onFileUpload}\n              />\n              &nbsp;browse files on this computer\n            </label>\n          </Typography>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n\n//Following https://stackoverflow.com/a/61731037\nfunction DecoratedDivider({style, children}) {\n  return (\n    <div style={{alignItems: 'center', display: 'flex', ...style}}>\n      <div style={{border: '1px solid #E9E9E9', width: '50%'}}/>\n        {children}\n      <div style={{border: '1px solid #E9E9E9', width: '50%'}}/>\n    </div>\n  );\n}\n","import Start from './Start.js';\nimport { createMuiTheme, ThemeProvider } from '@material-ui/core/styles';\nimport { fade } from '@material-ui/core/styles/colorManipulator';\nimport { useState } from 'react';\nimport AppBar from '@material-ui/core/AppBar';\nimport Toolbar from '@material-ui/core/Toolbar';\nimport IconButton from '@material-ui/core/IconButton';\nimport MenuIcon from '@material-ui/icons/Menu';\nimport HomeIcon from '@material-ui/icons/Home';\nimport Menu from '@material-ui/core/Menu';\nimport MenuList from '@material-ui/core/MenuList';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogContentText from '@material-ui/core/DialogContentText';\n\nconst defaultBlack = '#292929';\nconst selectionTextColor = '#FFFFFF';\nconst selectionColor = '#1F1F4D';\nconst defaultBorder = '2px solid';\nconst defaultRadius = '5px';\nconst defaultOpacity = 0.8;\n\nconst theme = createMuiTheme({\n  typography: {\n    fontFamily: '\"Open Sans\", sans-serif',\n    fontWeightRegular: 500,\n    h1: {\n     fontSize: '2rem',\n     lineHeight: '3rem', //same line height throughout, so first visible component appears in consistent place\n    },\n    h2: {\n      fontWeight: 600,\n      fontSize: '1.5rem',\n      lineHeight: '3rem', //same line height throughout, so first visible component appears in consistent place\n    },\n    h3: {\n      fontSize: '1.3rem',\n      lineHeight: '3rem', //same line height throughout, so first visible component appears in consistent place\n    },\n    button: {\n      fontSize: '1.1rem',\n    },\n  },\n  palette: {\n    primary: {\n      main: defaultBlack,\n    },\n    text: {\n      primary: defaultBlack,\n    },\n    action: {\n      hoverOpacity: defaultOpacity,\n    }\n  },\n  overrides: {\n    MuiButton: {\n      root: {\n        border: defaultBorder,\n        borderColor: defaultBlack,\n        borderRadius: defaultRadius,\n        textTransform: 'none',\n        '&:hover': {\n          backgroundColor: selectionColor,\n          color: selectionTextColor,\n        },\n      },\n    },\n    MuiToggleButton: {\n      root: {\n        border: defaultBorder,\n        borderColor: defaultBlack,\n        borderRadius: defaultRadius,\n        textTransform: 'none',\n        color: defaultBlack,\n        '&:hover': {\n          backgroundColor: fade(selectionColor, defaultOpacity),\n          borderColor: defaultBlack,\n          color: selectionTextColor,\n        },\n        '&$selected': {\n          backgroundColor: selectionColor,\n          borderColor: defaultBlack,\n          color: selectionTextColor,\n        },\n        '&$disabled': {\n          backgroundColor: selectionColor,\n          borderColor: defaultBlack,\n          color: selectionTextColor,\n        },\n      },\n    },\n    MuiSelect: {\n      root: {\n        border: defaultBorder,\n        borderRadius: defaultRadius,\n      },\n    },\n    MuiCheckbox: {\n      colorSecondary: {\n        '&$checked': {\n          color: selectionColor,\n        },\n        '&:hover': {\n          backgroundColor: fade(selectionColor, defaultOpacity),\n        },\n      },\n    },\n    MuiSlider: {\n      root: {\n        color: selectionColor,\n      },\n    },\n    MuiCircularProgress: {\n      colorPrimary: {\n        color: selectionColor,\n      },\n    },\n  },\n});\n\n// The div will be the outer wrapping\n// for all screens, so its spacing-out\n// styling applies to all screens.\nexport default function App() {\n  const [menuLocation, setMenuLocation] = useState(null);\n  const [aboutOpen, setAboutOpen] = useState(false);\n\n  return (\n    <div>\n      <ThemeProvider theme={theme}>\n        <AppBar style={{backgroundColor: '#3f51b5'}} position=\"fixed\">\n          <Toolbar>\n            <IconButton onClick={()=> {window.location.reload();}}>\n              <HomeIcon style={{color: 'white'}}/>\n            </IconButton>\n            <IconButton onClick={(e)=>{setMenuLocation(e.currentTarget);}}>\n              <MenuIcon style={{color: 'white'}}/>\n            </IconButton>\n              <Menu\n                anchorEl={menuLocation}\n                open={Boolean(menuLocation)}\n              >\n                <MenuList onMouseLeave={()=>{setMenuLocation(null);}}>\n                  <MenuItem><a href=\"https://github.com/tanc-ahrc/deep-discoveries-frontend\">Source (GitHub)</a></MenuItem>\n                  <MenuItem onClick={()=>{setAboutOpen(true);}}>About</MenuItem>\n                </MenuList>\n              </Menu>\n          </Toolbar>\n        </AppBar>\n        <Dialog open={aboutOpen} onClose={()=>{setAboutOpen(false);}}>\n          <DialogTitle>About</DialogTitle>\n          <DialogContent>\n            <DialogContentText>Designed by ...</DialogContentText>\n            <DialogContentText>Copyright &copy; 2021 Crown Copyright (The National Archives) except where otherwise stated in the source.</DialogContentText>\n            <DialogContentText>Licensed under the MIT License.</DialogContentText>\n            <DialogContentText>See <a href=\"https://github.com/tanc-ahrc/deep-discoveries-frontend\">source</a> for details.</DialogContentText>\n          </DialogContent>\n        </Dialog>\n        <div style={{position: 'relative', top: '10vh'}}>\n          <Start/>\n        </div>\n      </ThemeProvider>\n    </div>\n  );\n}\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}