{"version":3,"sources":["DetailSelector.js","ScaledImage.js","DetailSelection.js","BasicSearchSidebar.js","SearchDatum.js","Backend.js","BasicSearchResults.js","BasicSearch.js","Start.js","App.js","reportWebVitals.js","index.js"],"names":["DetailSelector","src","shadingColor","shadingOpacity","selections","setSelections","containerId","useState","Image","image","naturalWidth","width","setWidth","naturalHeight","height","setHeight","React","useEffect","widthScale","heightScale","scale","selectorSize","newSelections","initHole","x","y","opacity","Konva","Circle","radius","fillPatternImage","fillPatternOffset","fillPatternScale","stage","Stage","container","background","shading","Rect","fill","strokeWidth","visible","select","draggable","stroke","layer","Layer","add","forEach","selection","hole","on","e","style","cursor","draw","evt","layerX","layerY","batchDraw","push","s","slice","document","getElementById","handleResize","offsetWidth","scrollWidth","offsetHeight","scrollHeight","window","addEventListener","removeEventListener","overflow","id","ScaledImage","props","tileSize","onload","useStyles","makeStyles","theme","masonry","display","marginLeft","masonryColumn","paddingLeft","masonryCell","marginBottom","palette","action","hoverOpacity","DetailSelection","input","setInput","detailList","setDetailList","cancelDetailSearch","classes","detailImage","setDetailImage","Grid","item","xs","Typography","variant","Button","fullWidth","onClick","breakpointCols","className","columnClassName","concat","map","d","aid","url","cloneSelections","selectionsChomp","stack","current","undefined","clone","type","payload","disabled","length","i","j","s1","s2","selectionsMatch","paddingTop","newSelection","newCurrent","newStack","BasicSearchSidebar","onNewSearch","onDetailSearch","Container","spacing","align","FormControl","InputLabel","Select","labelId","SearchDatum","this","c","Object","create","a","endpoint","send","resultCount","details","callback","engine","synchronous","formData","FormData","file","append","getWeights","xhr","XMLHttpRequest","open","initialResults","JSON","parse","responseText","filter","r","collection","getCollectionInfo","name","computeCircle","circle","fillPatternScaleX","fillPatternScaleY","console","error","center_x","Math","max","min","center_y","rect_top","round","rect_bottom","rect_left","rect_right","sq_radius","marked","sq_x","sq_y","weights","detail","weight_encoding","Array","circleArray","columns","column","join","BasicSearchResults","results","setResults","setTileSize","showLikeness","setShowLikeness","heatmapurl","ToggleButtonGroup","exclusive","value","onChange","n","ToggleButton","borderRadius","fontSize","lineHeight","textTransform","IconButton","size","color","Slider","step","result","ResultTile","overlay","isChecked","padding","margin","position","top","left","zIndex","Card","borderColor","CardContent","justify","Checkbox","checked","paddingRight","BasicSearch","useReducer","oldResults","newResult","Error","oldDetailList","newDetail","splice","warn","detailSearch","setDetailSearch","uploadText","textAlign","inputZone","border","boxSizing","tile","Start","images","count","response","randomImages","tooltip_pos","updateFileInput","Promise","resolve","reader","FileReader","target","readAsDataURL","datum","DndProvider","backend","HTML5Backend","paddingBottom","InputZone","onFileDrop","f","onURLDrop","u","onAssetDrop","onFileUpload","files","DecoratedDivider","GridList","cols","justifyContent","documentElement","clientWidth","asset","GridListTile","data-tip","data-effect","data-place","ImageTile","useDrag","drag","ref","objectFit","useDrop","accept","NativeTypes","FILE","URL","drop","monitor","getItemType","getItem","urls","ext","substring","lastIndexOf","flexDirection","children","alignItems","defaultBlack","selectionTextColor","selectionColor","defaultBorder","defaultRadius","createMuiTheme","typography","fontFamily","fontWeightRegular","h1","h2","fontWeight","h3","button","primary","main","text","overrides","MuiButton","root","backgroundColor","MuiToggleButton","fade","MuiSelect","MuiCheckbox","colorSecondary","MuiSlider","App","menuLocation","setMenuLocation","aboutOpen","setAboutOpen","ThemeProvider","AppBar","Toolbar","edge","currentTarget","anchorEl","Boolean","MenuList","onMouseLeave","MenuItem","href","Dialog","onClose","DialogTitle","DialogContent","DialogContentText","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode"],"mappings":"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","file":"static/js/main.f512890e.chunk.js","sourcesContent":["/* Derived from src/avatar.jsx, in master branch of\n    https://github.com/kirill3333/react-avatar.git, commit\n    60d7a5f728ce276d9cbe84f1773ebf32abddf995.\n * avatar.jsx copyright (c) 2017 Kirill Novikov, MIT license\n * All changes copyright (c) 2021 Crown Copyright (The National Archives), MIT license\n * For MIT license, see https://github.com/tanc-ahrc/deep-discoveries-interface-building-blocks/blob/master/LICENSE.\n */\n\nimport React from 'react'\nimport { useState, useEffect } from 'react';\nimport Konva from 'konva/lib/Core';\nimport 'konva/lib/shapes/Image';\nimport 'konva/lib/shapes/Rect';\nimport 'konva/lib/shapes/Circle';\n\nexport default function DetailSelector({src, shadingColor, shadingOpacity, selections, setSelections}) {\n  const containerId = 'imageviewer_component';\n  const [image] = useState(new Image());\n  image.src = src;\n  const [width, setWidth] = useState(image.naturalWidth);\n  const [height, setHeight] = useState(image.naturalHeight);\n\n  React.useEffect(() => {\n    // Scale to the smaller dimension\n    let widthScale = width / image.naturalWidth;\n    let heightScale = height / image.naturalHeight;\n    const scale = widthScale < heightScale ? widthScale : heightScale;\n\n    // Base selector size on the smaller factor. Magic constant arrived at by trial and error.\n    const selectorSize = widthScale < heightScale ? image.naturalWidth  * scale * 0.025 * 0.5\n                                                  : image.naturalHeight * scale * 0.025 * 0.5;\n\n    const newSelections = [];\n\n    // TODO: Could make more sense to create a subclass of Rect.\n    //       This would handle the boilerplate repetition in the\n    //       event handlers.\n    function initHole(x, y, opacity) {\n      return new Konva.Circle({\n        x: x,\n        y: y,\n        radius: selectorSize * 2,\n        fillPatternImage: image,\n        fillPatternOffset: { x: x, y: y },\n        fillPatternScale: { x: scale, y: scale },\n        opacity: opacity\n      });\n    }\n\n    const stage = new Konva.Stage({\n      container: containerId,\n      width: image.naturalWidth * scale,\n      height: image.naturalHeight * scale\n    });\n\n    const background = new Konva.Image({\n      x: 0,\n      y: 0,\n      width: image.naturalWidth * scale,\n      height: image.naturalHeight * scale,\n      image: image\n    });\n\n    const shading = new Konva.Rect({\n      x: 0,\n      y: 0,\n      width: background.width(),\n      height: background.height(),\n      fill: shadingColor,\n      strokeWidth: 0,\n      opacity: shadingOpacity,\n      visible: true\n    });\n\n    const select = initHole(0, 0, 1);\n    select.visible(false);\n    select.draggable(true);\n    select.stroke('white');\n    select.strokeWidth(1);\n    //TODO: May want to fiddle the size of select so that the part covered\n    //      by the stroke is not included in the selection.\n\n    const layer = new Konva.Layer();\n    layer.add(background);\n    layer.add(shading);\n    layer.add(select);\n    stage.add(layer);\n\n    selections.forEach((selection) => {\n      selection.forEach((hole) => {\n        layer.add(hole);\n      });\n    });\n\n    stage.on(\"mouseenter\", (e) => {\n      select.visible(true);\n      stage.container().style.cursor = 'none';\n    });\n\n    stage.on(\"mouseleave\", (e) => {\n      select.visible(false);\n      stage.container().style.cursor = 'default';\n      layer.draw();\n    });\n\n    stage.on(\"mousemove\", (e) => {\n      const x = e.evt.layerX - selectorSize;\n      const y = e.evt.layerY - selectorSize;\n      select.x(x);\n      select.y(y);\n      select.fillPatternOffset({x: x, y: y});\n      layer.batchDraw();\n    });\n\n    stage.on(\"mousedown dragmove\", (e) => {\n      const x = e.evt.layerX - selectorSize;\n      const y = e.evt.layerY - selectorSize;\n      const hole = initHole(x, y, 1);\n      layer.add(hole);\n      newSelections.push(hole);\n      layer.batchDraw();\n    });\n\n    stage.on(\"mouseup dragend dragleave dragexit\", () => {\n      const s = selections.slice();\n      s.push(newSelections);\n      setSelections(s);\n    });\n\n    layer.draw();\n  }, [width, height, shadingColor, shadingOpacity, image, selections, setSelections]);\n\n  /* Resizing tricks following https://www.pluralsight.com/guides/re-render-react-component-on-window-resize */\n  useEffect(\n    () => {\n      const e = document.getElementById(containerId);\n      function handleResize() {\n        // -1 here to avoid infinite loops when the width is fractionally smaller than the offsetWidth\n        if(width < e.offsetWidth - 1 ||      // make the image bigger if it is not using all the space\n          e.offsetWidth < e.scrollWidth) {   // make the image smaller if it is using too much space\n          setWidth(e.offsetWidth);\n        }\n\n        // -1 here to avoid infinite loops when the height is fractionally smaller than the offsetHeight\n        if(height < e.offsetHeight - 1 ||    // make the image bigger if it is not using all the space\n          e.offsetHeight < e.scrollHeight) { // make the image smaller if it is using too much space\n          setHeight(e.offsetHeight);\n        }\n      }\n      handleResize(); //ensure that we are sized correctly\n      window.addEventListener('resize', handleResize);\n\n      return () => {\n        window.removeEventListener('resize', handleResize);\n      }\n    },\n    [image, width, height]\n  );\n\n  /* TODO: The sizing should be handled at the DetailSelector component and passed down. */\n  return (\n    <div width='100%'>\n      <div style={{overflow: 'hidden', height: '70vh', width: '70vw'}} id={containerId} />\n    </div>\n  );\n}\n","import { useState, useEffect } from 'react';\nimport Konva from 'konva/lib/Core';\nimport 'konva/lib/shapes/Image';\n\n/* Derived from src/avatar.jsx, in master branch of\n    https://github.com/kirill3333/react-avatar.git, commit\n    60d7a5f728ce276d9cbe84f1773ebf32abddf995.\n * avatar.jsx copyright (c) 2017 Kirill Novikov, MIT license\n * All changes copyright (c) 2021 Crown Copyright (The National Archives), MIT license\n * For MIT license, see https://github.com/tanc-ahrc/deep-discoveries-interface-building-blocks/blob/master/LICENSE.\n */\nexport default function ScaledImage({id, src, tileSize, ...props}) {\n  const containerId = 'ScaledImage_' + id;\n  const [width, setWidth] = useState(0);\n  const [image] = useState(new Image());\n  image.src = src;\n\n  useEffect(\n    /* Resizing tricks following\n     * www.pluralsight.com/guides/re-render-react-component-on-window-resize\n     */\n    () => {\n      const e = document.getElementById(containerId);\n      function handleResize() {\n        if(image.width !== e.offsetWidth || e.offsetWidth !== e.scrollWidth) {\n          setWidth(e.offsetWidth);\n        }\n      }\n      handleResize(); //ensure that we are sized correctly\n      window.addEventListener('resize', handleResize);\n\n      image.onload = () => {\n        const scale = width / image.width;\n        const stage = new Konva.Stage({\n          container: containerId,\n          width: width,\n          height: image.height * scale,\n        });\n        const background = new Konva.Image({\n          x: 0,\n          y: 0,\n          width: image.width * scale,\n          height: image.height * scale,\n          image: image,\n        });\n        const layer = new Konva.Layer();\n        layer.add(background);\n        stage.add(layer);\n        layer.draw();\n      };\n\n      return () => {\n        window.removeEventListener('resize', handleResize);\n      }\n    }, [containerId, image, width]);\n\n    return (<div id={containerId} {...props}/>);\n}\n","//TODO: The {stack, current} entity should really be\n//      a proper class with its own methods, rather\n//      than being externally manipulated all over\n//      the place.\n\nimport Grid from '@material-ui/core/Grid';\nimport Typography from '@material-ui/core/Typography';\nimport Button from '@material-ui/core/Button';\nimport { makeStyles} from '@material-ui/core/styles';\nimport { useState } from 'react';\nimport Masonry from 'react-masonry-css';\nimport DetailSelector from './DetailSelector.js';\nimport ScaledImage from './ScaledImage.js';\n\nconst useStyles = makeStyles((theme) => ({\n  masonry: {\n    display: 'flex',\n    marginLeft: '-10px',\n  },\n  masonryColumn: {\n    paddingLeft: '10px',\n  },\n  masonryCell: {\n    marginBottom: '10px',\n    '&:hover': {\n      cursor: 'pointer',\n      opacity: theme.palette.action.hoverOpacity,\n    },\n  },\n}));\n\nexport default function DetailSelection({input, setInput, detailList, setDetailList, cancelDetailSearch}) {\n  const classes = useStyles();\n\n  const [detailImage, setDetailImage] = useState();\n  const [selections, setSelections] = useState();\n\n  function pushSelection(newSelection) {\n    const newCurrent = selections.current + 1;\n    const newStack = selections.stack.slice(0, newCurrent);\n    newStack.push(newSelection);\n    setSelections({stack: newStack, current: newCurrent});\n  }\n  function undo() { setSelections({stack: selections.stack, current: selections.current - 1}); }\n  function redo() { setSelections({stack: selections.stack, current: selections.current + 1}); }\n  function clear(){ setSelections({stack: [[]], current: 0}); }\n\n  if(typeof detailImage === typeof undefined) {\n    return (\n      <Grid container>\n        <Grid item xs={12}>\n          <Typography variant='h3'>Click an image to highlight areas of interest</Typography>\n        </Grid>\n        <Grid container>\n          <Grid container item xs={2}>\n            <Grid item xs={11}>\n              <Button fullWidth={true} onClick={cancelDetailSearch}>Update search</Button>\n            </Grid>\n          </Grid>\n          <Grid item xs={10}>\n            <Masonry\n              breakpointCols={3}\n              className={classes.masonry}\n              columnClassName={classes.masonryColumn}\n            >\n              {[input].concat(detailList).map((d) => (\n                <ScaledImage className={classes.masonryCell}\n                             key={d.aid}\n                             id={d.aid}\n                             src={d.url}\n                             onClick={()=>{setSelections(d.cloneSelections()); setDetailImage(d);}}\n                />\n              ))}\n            </Masonry>\n          </Grid>\n        </Grid>\n      </Grid>\n    );\n  }\n  else {\n    function selectionsChomp() {\n      return {\n        stack: selections.stack.slice(0, selections.current + 1),\n        current: selections.current,\n      };\n    }\n\n    function selectionsMatch() {\n      const s = selectionsChomp();\n      if(s.stack.length !== detailImage.selections.stack.length) return false;\n      if(s.current !== detailImage.selections.current) return false;\n      for(let i = 0; i < s.stack.length; i++) {\n        if(s.stack[i].length !== detailImage.selections.stack[i].length) return false;\n      }\n      for(let i = 0; i < s.stack.length; i++) {\n        for(let j = 0; j < s.stack[i].length; j++) {\n          const s1 = s.stack[i][j];\n          const s2 = detailImage.selections.stack[i][j];\n          if(s1.radius !== s2.radius) return false;\n          if(s1.x !== s2.x) return false;\n          if(s1.y !== s2.y) return false;\n        }\n      }\n      return true;\n    }\n\n    return (\n      <Grid container>\n        <Grid item xs={12}>\n          <Typography variant='h3'>Click and draw over the image to highlight areas of interest.</Typography>\n        </Grid>\n        <Grid container item xs={2}>\n          <Grid item xs={11}>\n            <Button fullWidth={true} onClick={()=>{setDetailImage(undefined);}}>Cancel</Button>\n            <Button fullWidth={true} onClick={()=>{\n                      const d = detailImage.clone();\n                      d.selections = selectionsChomp();\n                      if(d.aid === input.aid) { setInput(d); }\n                      else { setDetailList({type: 'update', payload: d}); }\n                      setDetailImage(undefined);\n                    }}\n                    disabled={selectionsMatch()}\n            >Update selections</Button>\n            <div style={{paddingTop: '2vh'}}/>\n            <Button fullWidth={true} disabled={selections.current === 0}                           onClick={undo}>Undo</Button>\n            <Button fullWidth={true} disabled={selections.current === selections.stack.length - 1} onClick={redo}>Redo</Button>\n            <Button fullWidth={true} disabled={selections.current === 0} onClick={clear}>Clear</Button>\n          </Grid>\n        </Grid>\n        <Grid item xs={10}>\n          <DetailSelector src={detailImage.url}\n                          shadingColor='black'\n                          shadingOpacity={0.5}\n                          selections={selections.stack[selections.current]}\n                          setSelections={pushSelection}/>\n        </Grid>\n      </Grid>\n    );\n  }\n}\n","import Container from '@material-ui/core/Container';\nimport Grid from '@material-ui/core/Grid';\nimport Button from '@material-ui/core/Button';\nimport Select from '@material-ui/core/Select';\nimport InputLabel from '@material-ui/core/InputLabel';\nimport FormControl from '@material-ui/core/FormControl';\n\nexport default function BasicSearchSidebar({input, onNewSearch, onDetailSearch}) {\n  return (\n    <Container>\n      <img src={input.url} width='100%'/>\n      <Grid container style={{paddingTop: '3vh'}} spacing={2}>\n        <Grid item xs={6}>\n          <Button fullWidth={true} onClick={onNewSearch}>New search</Button>\n        </Grid>\n        <Grid item xs={6} align='right'>\n          <Button fullWidth={true} onClick={onDetailSearch}>Detail search</Button>\n        </Grid>\n      </Grid>\n      <div style={{paddingTop: '6vh'}}/>\n      <FormControl fullWidth={true}>\n        <InputLabel id='recentSearchesLabel'>&nbsp;Recent searches</InputLabel>\n        <Select labelId='recentSearchesLabel'>\n          <option>Placeholder recent 1</option>\n          <option>Placeholder recent 2</option>\n        </Select>\n      </FormControl>\n      <div style={{paddingTop: '1vh'}}/>\n      <FormControl fullWidth={true}>\n        <InputLabel id='savedCollectionsLabel'>&nbsp;Saved collections</InputLabel>\n        <Select labelId='savedCollectionsLabel'>\n          <option>Placeholder saved 1</option>\n          <option>Placeholder saved 2</option>\n        </Select>\n      </FormControl>\n    </Container>\n  );\n}\n","export default class SearchDatum {\n  constructor(aid, url) {\n    this.aid = aid; //TODO: This should be called 'id', and just happens to be set to 'aid' for results from the server\n    this.url = url;\n    this.selections = {\n      stack: [[]],\n      current: 0,\n    };\n  }\n\n  clone() {\n    const c = Object.create(this);\n    c.selections = this.cloneSelections();\n    return c;\n  }\n\n  cloneSelections() {\n    return {\n      stack: this.selections.stack.map((a) => { return a.slice(); }),\n      current: this.selections.current,\n    };\n  }\n}\n","const endpoint = 'https://decade.ac.uk/deepdiscovery/api/upload';\n\nexport function send(input, resultCount, details, callback, engine = 'Style', synchronous = false) {\n  const formData = new FormData();\n  if(input) {\n    if     (input.file) formData.append('query_file', input.file);\n    else if(input.aid)  formData.append('query_aid',  input.aid);\n    else                formData.append('query_url',  input.url);\n  }\n  formData.append('searchengine', engine);\n  formData.append('resultcount', resultCount);\n  if(details) formData.append('weights', getWeights(details));\n\n  const xhr = new XMLHttpRequest();\n  xhr.open('POST', endpoint, !synchronous);\n  xhr.onload = function() {\n    let initialResults = JSON.parse(this.responseText);\n    initialResults = initialResults.filter((r) => {\n      return r.collection != null && getCollectionInfo(r.collection).name != null;\n    });\n    callback(initialResults);\n  };\n  xhr.send(formData);\n}\n\nexport function randomImages(count) {\n  let result;\n  send(null, count, null, (response) => {\n    result = response;\n  }, 'Random', true);\n  return result;\n}\n\nexport function getCollectionInfo(collection) {\n  if(collection == null) return null; /* matches on undefined or null */\n\n  let c = { id: collection };\n\n  if     (collection === \"RGBE\")   c.name = \"Royal Botanic Garden Edinburgh\";\n  else if(collection === \"TNA1\" ||\n          collection === \"TNA2\" ||\n          collection === \"TNA3\")   c.name = \"The National Archives\";\n  else if(collection === \"VA1\" ||\n          collection === \"VA2\")    c.name = \"Victoria & Albert Museum\";\n  else                             c.name = null;\n\n  return c;\n}\n\nfunction computeCircle(circle, map) {\n  const scale = circle.fillPatternScaleX();\n  if(scale !== circle.fillPatternScaleY()) {\n    console.error('Inconsistent scale');\n    //This is a Bad Thing as it means that the radius warps differently\n    //in each dimension, which'll make computing the selected pixels more\n    //tricky. We maintain aspect ratio when we scale images, so\n    //it should not happen. (And in an ideal world, we'd generate a png of\n    //the selections, so we would not need to do any of this calculation\n    //at all.)\n  }\n  const center_x = Math.max(Math.min(circle.x() / scale, map.length - 1), 0)\n  const center_y = Math.max(Math.min(circle.y() / scale, map[0].length - 1), 0)\n  const radius = circle.radius() / scale;\n\n  //following https://stackoverflow.com/a/14487680\n  const rect_top =    Math.max(Math.round(center_y - radius), 0);\n  const rect_bottom = Math.min(Math.round(center_y + radius), map[0].length - 1);\n  const rect_left =   Math.max(Math.round(center_x - radius), 0);\n  const rect_right =  Math.min(Math.round(center_x + radius), map.length - 1);\n  const sq_radius =   Math.round(radius * radius);\n  let marked = false;\n  for(let x = rect_left; x <= rect_right; x++) {\n    for(let y = rect_top; y <= rect_bottom; y++) {\n      let sq_x = (x - center_x); sq_x = sq_x * sq_x;\n      let sq_y = (y - center_y); sq_y = sq_y * sq_y;\n      if(sq_x + sq_y < sq_radius) {\n        marked = true;\n        map[x][y] = 1;\n      }\n    }\n  }\n\n  //If we did not mark anything at all, at least\n  //mark the centre of the circle. This can happen\n  //if a small image is drawn upon while very enlarged.\n  if(!marked) map[Math.round(center_x)][Math.round(center_y)] = 1;\n}\n\nfunction getWeights(detailList) {\n  const weights = [];\n  for(const detail of detailList) {\n    const image = new Image();\n    image.src = detail.url;\n    let weight_encoding = '' + detail.aid + '*' + image.naturalWidth + '*' + image.naturalHeight + '*';\n    const map = new Array(image.naturalWidth);\n    for(let i = 0; i < map.length; i++) {\n      map[i] = new Array(image.naturalHeight);\n      map[i].fill(0);\n    }\n    for(const circleArray of detail.selections.stack[detail.selections.current]) {\n      for(const circle of circleArray) {\n        computeCircle(circle, map);\n      }\n    }\n    const columns = [];\n    for(let y = 0; y < image.naturalHeight; y++) {\n      let column = '';\n      for(let x = 0; x < image.naturalWidth; x++) {\n        column += map[x][y];\n      }\n      columns.push(column);\n    }\n    weights.push(weight_encoding + columns.join(''));\n  }\n  return weights.join('');\n}\n","import Container from '@material-ui/core/Container';\nimport Typography from '@material-ui/core/Typography';\nimport Grid from '@material-ui/core/Grid';\nimport ToggleButtonGroup from '@material-ui/lab/ToggleButtonGroup';\nimport ToggleButton from '@material-ui/lab/ToggleButton';\nimport IconButton from '@material-ui/core/IconButton';\nimport Slider from '@material-ui/core/Slider';\nimport Card from '@material-ui/core/Card';\nimport CardContent from '@material-ui/core/CardContent';\nimport Checkbox from '@material-ui/core/Checkbox';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { useState, useEffect } from 'react';\nimport AddCircleOutlineOutlinedIcon from '@material-ui/icons/AddCircleOutlineOutlined';\nimport RemoveCircleOutlineOutlinedIcon from '@material-ui/icons/RemoveCircleOutlineOutlined';\nimport Masonry from 'react-masonry-css';\nimport SearchDatum from './SearchDatum.js';\nimport { send, getCollectionInfo } from './Backend.js';\n\nconst useStyles = makeStyles((theme) => ({\n  masonry: {\n    display: 'flex',\n    marginLeft: '-10px',\n  },\n  masonryColumn: {\n    paddingLeft: '10px',\n  },\n  masonryCell: {\n    marginBottom: '10px',\n  },\n}));\n\nexport default function BasicSearchResults({input, results, setResults, detailList, setDetailList}) {\n  const classes = useStyles();\n\n  const [tileSize, setTileSize] = useState(2);\n  const [showLikeness, setShowLikeness] = useState(false);\n\n  function getSimilar() {\n    send(input, 33, [input].concat(detailList), (initialResults) => {\n      //If the input was an asset, do not display it in the results\n      //TODO: We should shortcircuit. Or, probably, it is safe just to shift the first element off.\n      if(input.aid) initialResults = initialResults.filter((r) => { return r.aid !== input.aid; });\n\n      setResults({type: 'replace', payload: initialResults.map((x) => {\n        const y = new SearchDatum(x.aid, x.url);\n        y.collection = x.collection;\n        y.heatmapurl = x.heatmapurl;\n        return y;\n      })});\n    });\n  }\n\n  useEffect(getSimilar, [input, setResults, detailList]);\n\n  return (\n    <Container>\n      <Typography variant='h2' align='left'>Similar Images</Typography>\n      <Grid container>\n        <Grid item xs={6}>\n          <ToggleButtonGroup style={{width: '100%'}} exclusive value={showLikeness} onChange={(e, n)=>{if(n === true || n === false) setShowLikeness(n);}}>\n            <ToggleButton style={{borderRadius: '5px 0   0   5px', width: '50%'}} value={false} disabled={!showLikeness}>Image view</ToggleButton>\n            <ToggleButton style={{borderRadius: '0   5px 5px 0'  , width: '50%'}} value={true}  disabled={ showLikeness}>Likeness view</ToggleButton>\n          </ToggleButtonGroup>\n        </Grid>\n        <Grid item xs={3}>\n          <div/>\n        </Grid>\n        <Grid container item xs={3}>\n          <Grid item xs={12}>\n            <Typography style={{fontSize: 12, lineHeight: 1, textTransform: 'uppercase'}}>Image Size</Typography>\n          </Grid>\n          <Grid item xs={2} align='left'>\n            {/* Using IconButton 'disabled' can result in conditions where the images constantly switch\n              * between two sizes until the user clicks anywhere in the page, or the page crashes. */}\n            {/*disabled={tileSize === 1}*/}\n            <IconButton\n              size='small'\n              color='primary'\n              onClick={() => setTileSize(tileSize => tileSize > 1 ? tileSize - 1 : tileSize)}>\n              <RemoveCircleOutlineOutlinedIcon/>\n            </IconButton>\n          </Grid>\n          <Grid item xs={8}>\n            <Slider\n              value={tileSize}\n              onChange={ (e, x) => { setTileSize(x); } }\n              step={1}\n              min={1}\n              max={3}\n            />\n          </Grid>\n          <Grid item xs={2} align='right'>\n            <IconButton\n              size='small'\n              color='primary'\n              onClick={() => setTileSize(tileSize => tileSize < 3 ? tileSize + 1 : tileSize)}>\n              <AddCircleOutlineOutlinedIcon/>\n            </IconButton>\n          </Grid>\n        </Grid>\n      </Grid>\n      <Masonry breakpointCols={5 - tileSize}\n               className={classes.masonry}\n               columnClassName={classes.masonryColumn}\n               style={{paddingTop: '3vh'}}>\n        {results.map((result) => (\n          <ResultTile className={classes.masonryCell} key={result.aid} result={result} detailList={detailList} setDetailList={setDetailList} showLikeness={showLikeness} tileSize={tileSize}/>\n        ))}\n      </Masonry>\n    </Container>\n  );\n}\n\nfunction ResultTile({result, detailList, setDetailList, tileSize, showLikeness, ...props}) {\n  let isChecked = false;\n  for(const detail of detailList) {\n    if(result.aid === detail.aid) {\n      isChecked = true;\n      break;\n    }\n  }\n\n  // Pointer to a transparent png, for testing this:\n  // result.likeness = 'https://onlinepngtools.com/images/examples-onlinepngtools/clouds-transparent.png';\n  let overlay;\n  if(showLikeness) overlay = (\n    <img style={{height: '100%', width: '100%', padding: 0, margin: 0, position: 'absolute', top: 0, left: 0, zIndex: 2}}\n         src={result.heatmapurl}/>\n  );\n\n  return (\n    <Card {...props} variant='outlined' style={{borderColor:'#292929', borderRadius: '5px 5px 0 0'}}>\n      <CardContent style={{margin: 0, padding: 0}}>\n        <Grid container justify='space-between'>\n          <Grid item>\n            <Checkbox style={{margin: 0, padding: 0}}\n                      checked={isChecked}\n                      onChange={() => { setDetailList({type: isChecked ? 'remove' : 'add', payload: result.clone()}); }}\n            />\n          </Grid>\n          <Grid item><Typography style={{paddingRight: '3px'}}>{getCollectionInfo(result.collection).name}</Typography></Grid>\n        </Grid>\n        <div style={{position: 'relative', top: 0, left: 0}}>\n          <img style={{height: '100%', width: '100%', padding: 0, margin: 0, position: 'relative', top: 0, left: 0, zIndex: 1}} src={result.url}/>\n          {overlay}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","import Grid from '@material-ui/core/Grid';\nimport { useState, useReducer } from 'react';\nimport DetailSelection from './DetailSelection.js';\nimport BasicSearchSidebar from './BasicSearchSidebar.js';\nimport BasicSearchResults from './BasicSearchResults.js';\n\nexport default function BasicSearch({input, setInput}) {\n  const [results, setResults] = useReducer(\n    (oldResults, action) => {\n      const newResult = action.payload;\n      switch(action.type) {\n        case 'replace': { return newResult; }\n        case 'update':  { return oldResults.map((r) => { return r.aid === newResult.aid ? newResult : r; }); }\n        default:        throw new Error();\n      }\n    },\n    []\n  );\n  const [detailList, setDetailList] = useReducer(\n    (oldDetailList, action) => {\n      const newDetail = action.payload;\n      switch(action.type) {\n        case 'add': {\n          return oldDetailList.concat(newDetail);\n        }\n        case 'remove': {\n          for(let i = 0; i < oldDetailList.length; i++) {\n            if(newDetail.aid === oldDetailList[i].aid) {\n              oldDetailList.splice(i, 1);\n              return oldDetailList.slice();\n            }\n          }\n\n          //TODO: This function gets called twice when we hit the checkbox, so we always see this\n          //      warning. We must return a clone of the list in this case: even though it has not\n          //      changed, the checkbox will not get cleared unless we make it look like it has.\n          console.warn('Attempted to remove non-member from detailList', newDetail, oldDetailList);\n          return oldDetailList.slice();\n        }\n        case 'update': {\n          return oldDetailList.map((d) => { return d.aid === newDetail.aid ? newDetail: d; });\n        }\n        default: throw new Error();\n      }\n    },\n    []\n  );\n  const [detailSearch, setDetailSearch] = useState(false);\n  if(detailSearch) {\n    return (\n      <DetailSelection input={input}\n                       setInput={setInput}\n                       results={results}\n                       setResults={setResults}\n                       detailList={detailList}\n                       setDetailList={setDetailList}\n                       cancelDetailSearch={() => {setDetailSearch(false)}}\n      />\n    )\n  }\n  else {\n    return (\n      <Grid container spacing={3}>\n        <Grid item xs={3}>\n          <BasicSearchSidebar input={input} onNewSearch={() => {setInput(undefined);}} onDetailSearch={() => {setDetailSearch(true)}}/>\n        </Grid>\n        <Grid item xs={9}>\n          <BasicSearchResults input={input} results={results} setResults={setResults} detailList={detailList} setDetailList={setDetailList}/>\n        </Grid>\n      </Grid>\n    );\n  }\n}\n","/* TODO: The functional components in here would be\n *       pulled out to separate files, in an ideal\n *       world.\n * TODO: There must be a better way to space out the\n *       Container's components than putting\n *       paddingBottom: 1rem everywhere.\n */\n\nimport GridList from '@material-ui/core/GridList';\nimport GridListTile from '@material-ui/core/GridListTile';\nimport Container from '@material-ui/core/Container';\nimport Typography from '@material-ui/core/Typography';\nimport Card from '@material-ui/core/Card';\nimport CardContent from '@material-ui/core/CardContent';\nimport { useDrop, useDrag, DndProvider } from 'react-dnd';\nimport { NativeTypes, HTML5Backend } from 'react-dnd-html5-backend';\nimport ReactTooltip from 'react-tooltip';\nimport { useState } from 'react';\nimport { makeStyles } from '@material-ui/core/styles';\nimport BasicSearch from './BasicSearch.js';\nimport SearchDatum from './SearchDatum.js';\nimport {randomImages, getCollectionInfo} from './Backend.js';\n\nconst useStyles = makeStyles((theme) => ({\n  uploadText: {\n    textAlign: 'center',\n    color: '#3030EE',\n    '&:hover': {\n      color: '#3090EE',\n      cursor: 'pointer',\n    }\n  },\n  inputZone: {\n    background: '#F5F5F5',\n    border: '1px dashed #595959',\n    boxSizing: 'border-box',\n    borderRadius: '5px',\n    textAlign: 'center',\n  },\n  tile: {\n    '&:hover': {\n      opacity: theme.palette.action.hoverOpacity,\n      cursor: 'pointer',\n    },\n  },\n}));\n\nexport default function Start() {\n  const classes = useStyles();\n\n  const [input, setInput] = useState();\n  const images = randomImages(8);\n  for(let i = 0; i < 4; i++) images[i].tooltip_pos = 'top';\n  for(let i = 4; i < 8; i++) images[i].tooltip_pos = 'bottom'\n\n  //For onFileDrop and onFileUpload in the InputZone, below\n  async function updateFileInput(file) {\n    const url = await new Promise((resolve) => {\n      const reader = new FileReader();\n      reader.onload = (e) => { resolve(e.target.result); };\n      reader.readAsDataURL(file);\n    });\n    const datum = new SearchDatum(0, url);\n    datum.file = file;\n    setInput(datum);\n  }\n\n  if(typeof input === typeof undefined) {\n    return (\n      <DndProvider backend={HTML5Backend}>\n        <ReactTooltip/>\n        <Container style={{width: '50vw'}} justify='center'>\n          <Typography variant='h1' align='center'>\n            Explore our National Collection\n          </Typography>\n          <Typography style={{color: '#717171', paddingBottom: '1rem'}} align='center'>\n            Search with an image to find similar results\n          </Typography>\n          <InputZone style={{paddingBottom: '1rem'}}\n            onFileDrop   = { (f) => updateFileInput(f) }\n            onURLDrop    = { (u) => setInput(new SearchDatum(0, u)) }\n            onAssetDrop  = { (a) => setInput(a) }\n            onFileUpload = { (e) => updateFileInput(e.target.files[0]) }\n          />\n          <DecoratedDivider style={{paddingBottom: '1rem'}}>\n            <Typography>&nbsp;Or&nbsp;</Typography>\n          </DecoratedDivider>\n          <Typography style={{paddingBottom: '1rem'}} align='center'>\n            Click a sample image to try it\n          </Typography>\n\n          {/*TODO: Display properties set by trial and error. Rarely, this sizes so that I have more than 2 rows.\n                   This could surely be better, but it is plenty enough for a prototype. */}\n          <GridList cols={4} style={{justifyContent: 'center'}} spacing={document.documentElement.clientWidth * 0.01}>\n          {\n            images.map(\n              (asset) => (\n                <GridListTile key={asset.aid} style={{height: '11vw', width: '11vw'}}\n                              data-tip={getCollectionInfo(asset.collection).name} data-effect='solid' data-place={asset.tooltip_pos}>\n                  <ImageTile\n                    className={classes.tile}\n                    asset={asset}\n                    onClick={ () => setInput(new SearchDatum(asset.aid, asset.url)) }\n                  />\n                </GridListTile>\n              )\n            )\n          }\n          </GridList>\n        </Container>\n      </DndProvider>\n    )\n  }\n  else {\n    return (<BasicSearch input={input} setInput={setInput}/>);\n  }\n}\n\nfunction ImageTile({className, asset, onClick}) {\n  const [, drag] = useDrag({\n    type: 'ASSET',\n    item: {\n      asset: asset\n    }\n  });\n\n  return (\n    <img className={className} ref={drag} onClick={onClick} src={asset.url} height='100%' width='100%' style={{objectFit: 'cover'}}/>\n  );\n}\n\nfunction InputZone({style, onFileDrop, onURLDrop, onAssetDrop, onFileUpload}) {\n  const classes = useStyles();\n\n  const [, drop] = useDrop({\n    accept: [NativeTypes.FILE, NativeTypes.URL, 'ASSET'],\n    drop: (item, monitor) => {\n      if(monitor.getItemType() === NativeTypes.FILE) {\n        const files = monitor.getItem().files;\n        if(files.length !== 1) return;\n        const file = files[0];\n        if(file.type !== 'image/jpeg' && file.type !== 'image/png') return;\n        onFileDrop(file);\n      }\n      else if(monitor.getItemType() === NativeTypes.URL) {\n        const urls = monitor.getItem().urls;\n        if(urls.length !== 1) return;\n        const url = urls[0]\n        const ext = url.substring(url.lastIndexOf('.') + 1);\n        if(ext !== \"jpg\" &&\n           ext !== \"jpeg\" &&\n           ext !== \"png\") return;\n        onURLDrop(url);\n      }\n      else if(monitor.getItemType() === 'ASSET') {\n        const asset = monitor.getItem().asset;\n        onAssetDrop(asset);\n      }\n    },\n  });\n\n  //Following https://stackoverflow.com/a/25825731 for the file input trick \n  //Following https://stackoverflow.com/a/56342694 for the text alignment (CardContent style)\n  return(\n    <div ref={drop} style={style}>\n      <Card className={classes.inputZone}>\n        <CardContent style={{height: '30vh', display: 'flex', flexDirection: 'column', justifyContent: 'center'}}>\n          <Typography>\n            Drag an image here or\n            <label className={classes.uploadText}>\n              <input style={{display: 'none'}}\n                     type='file'\n                     accept='image/jpeg,image/png'\n                     onChange={onFileUpload}\n              />\n              &nbsp;browse files on this computer\n            </label>\n          </Typography>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n\n//Following https://stackoverflow.com/a/61731037\nfunction DecoratedDivider({style, children}) {\n  return (\n    <div style={{alignItems: 'center', display: 'flex', ...style}}>\n      <div style={{border: '1px solid #E9E9E9', width: '50%'}}/>\n        {children}\n      <div style={{border: '1px solid #E9E9E9', width: '50%'}}/>\n    </div>\n  );\n}\n","import Start from './Start.js';\nimport { createMuiTheme, ThemeProvider } from '@material-ui/core/styles';\nimport { fade } from '@material-ui/core/styles/colorManipulator';\nimport { useState } from 'react';\nimport AppBar from '@material-ui/core/AppBar';\nimport Toolbar from '@material-ui/core/Toolbar';\nimport IconButton from '@material-ui/core/IconButton';\nimport MenuIcon from '@material-ui/icons/Menu';\nimport Menu from '@material-ui/core/Menu';\nimport MenuList from '@material-ui/core/MenuList';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogContentText from '@material-ui/core/DialogContentText';\n\nconst defaultBlack = '#292929';\nconst selectionTextColor = '#FFFFFF';\nconst selectionColor = '#1F1F4D';\nconst defaultBorder = '2px solid';\nconst defaultRadius = '5px';\nconst defaultOpacity = 0.8;\n\nconst theme = createMuiTheme({\n  typography: {\n    fontFamily: '\"Open Sans\", sans-serif',\n    fontWeightRegular: 500,\n    h1: {\n     fontSize: '2rem',\n     lineHeight: '3rem', //same line height throughout, so first visible component appears in consistent place\n    },\n    h2: {\n      fontWeight: 600,\n      fontSize: '1.5rem',\n      lineHeight: '3rem', //same line height throughout, so first visible component appears in consistent place\n    },\n    h3: {\n      fontSize: '1.3rem',\n      lineHeight: '3rem', //same line height throughout, so first visible component appears in consistent place\n    },\n    button: {\n      fontSize: '1.1rem',\n    },\n  },\n  palette: {\n    primary: {\n      main: defaultBlack,\n    },\n    text: {\n      primary: defaultBlack,\n    },\n    action: {\n      hoverOpacity: defaultOpacity,\n    }\n  },\n  overrides: {\n    MuiButton: {\n      root: {\n        border: defaultBorder,\n        borderColor: defaultBlack,\n        borderRadius: defaultRadius,\n        textTransform: 'none',\n        '&:hover': {\n          backgroundColor: selectionColor,\n          color: selectionTextColor,\n        },\n      },\n    },\n    MuiToggleButton: {\n      root: {\n        border: defaultBorder,\n        borderColor: defaultBlack,\n        borderRadius: defaultRadius,\n        textTransform: 'none',\n        color: defaultBlack,\n        '&:hover': {\n          backgroundColor: fade(selectionColor, defaultOpacity),\n          borderColor: defaultBlack,\n          color: selectionTextColor,\n        },\n        '&$selected': {\n          backgroundColor: selectionColor,\n          borderColor: defaultBlack,\n          color: selectionTextColor,\n        },\n        '&$disabled': {\n          backgroundColor: selectionColor,\n          borderColor: defaultBlack,\n          color: selectionTextColor,\n        },\n      },\n    },\n    MuiSelect: {\n      root: {\n        border: defaultBorder,\n        borderRadius: defaultRadius,\n      },\n    },\n    MuiCheckbox: {\n      colorSecondary: {\n        '&$checked': {\n          color: selectionColor,\n        },\n        '&:hover': {\n          backgroundColor: fade(selectionColor, defaultOpacity),\n        },\n      },\n    },\n    MuiSlider: {\n      root: {\n        color: selectionColor,\n      },\n    },\n  },\n});\n\n// The div will be the outer wrapping\n// for all screens, so its spacing-out\n// styling applies to all screens.\nexport default function App() {\n  const [menuLocation, setMenuLocation] = useState(null);\n  const [aboutOpen, setAboutOpen] = useState(false);\n\n  return (\n    <div>\n      <ThemeProvider theme={theme}>\n        <AppBar style={{backgroundColor: '#3f51b5'}} position=\"fixed\">\n          <Toolbar>\n            <IconButton edge=\"end\" onClick={(e)=>{setMenuLocation(e.currentTarget);}}>\n              <MenuIcon/>\n            </IconButton>\n              <Menu\n                anchorEl={menuLocation}\n                open={Boolean(menuLocation)}\n              >\n                <MenuList onMouseLeave={()=>{setMenuLocation(null);}}>\n                  <MenuItem><a href=\"https://github.com/tanc-ahrc/deep-discoveries-frontend\">Source (GitHub)</a></MenuItem>\n                  <MenuItem onClick={()=>{setAboutOpen(true);}}>About</MenuItem>\n                </MenuList>\n              </Menu>\n          </Toolbar>\n        </AppBar>\n        <Dialog open={aboutOpen} onClose={()=>{setAboutOpen(false);}}>\n          <DialogTitle>About</DialogTitle>\n          <DialogContent>\n            <DialogContentText>Designed by ...</DialogContentText>\n            <DialogContentText>Copyright &copy; 2021 Crown Copyright (The National Archives) except where otherwise stated in the source.</DialogContentText>\n            <DialogContentText>Licensed under the MIT License.</DialogContentText>\n            <DialogContentText>See <a href=\"https://github.com/tanc-ahrc/deep-discoveries-frontend\">source</a> for details.</DialogContentText>\n          </DialogContent>\n        </Dialog>\n        <div style={{position: 'relative', top: '10vh'}}>\n          <Start/>\n        </div>\n      </ThemeProvider>\n    </div>\n  );\n}\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}