(this["webpackJsonpdeep-discoveries-frontend"]=this["webpackJsonpdeep-discoveries-frontend"]||[]).push([[0],{227:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),r=n(13),c=n.n(r),s=n(12),o=n(34),l=n(102),d=n.n(l),u=n(135),h=n(287),j=n(288),f=n(279),b=n(157),A=n(284),p=n(285),g=n(286),x=n(297),m=n(298),O=n(56),v=n(89),y=n(274),w=n(276),C=n(278),D=n(80),S=n.n(D),k=n(52),L=n(23),M=n.n(L),P=(n(118),n(180),n(181),n(3));function E(e){var t=e.src,n=e.shadingColor,r=e.shadingOpacity,c=e.selections,l=e.setSelections,d=Object(k.a)(e,["src","shadingColor","shadingOpacity","selections","setSelections"]),u="imageviewer_component",h=Object(a.useState)(new Image),j=Object(s.a)(h,1)[0];j.src=t;var f=Object(a.useState)(j.naturalWidth),b=Object(s.a)(f,2),A=b[0],p=b[1],g=Object(a.useState)(j.naturalHeight),x=Object(s.a)(g,2),m=x[0],O=x[1];return i.a.useEffect((function(){var e=A/j.naturalWidth,t=m/j.naturalHeight,a=e<t?e:t,i=e<t?j.naturalWidth*a*.025*.5:j.naturalHeight*a*.025*.5,s=[];function o(e,t,n){return new M.a.Circle({x:e,y:t,radius:2*i,fillPatternImage:j,fillPatternOffset:{x:e,y:t},fillPatternScale:{x:a,y:a},opacity:n})}var d=new M.a.Stage({container:u,width:j.naturalWidth*a,height:j.naturalHeight*a}),h=new M.a.Image({x:0,y:0,width:j.naturalWidth*a,height:j.naturalHeight*a,image:j}),f=new M.a.Rect({x:0,y:0,width:h.width(),height:h.height(),fill:n,strokeWidth:0,opacity:r,visible:!0}),b=o(0,0,1);b.visible(!1),b.draggable(!0),b.stroke("white"),b.strokeWidth(1);var p=new M.a.Layer;p.add(h),p.add(f),p.add(b),d.add(p),c.forEach((function(e){e.forEach((function(e){var t=e.fillPatternScaleX();t!==e.fillPatternScaleY()&&console.error("Inconsistent scale");var n=Math.max(Math.min(a*(e.x()/t),j.width*a-1),0),i=Math.max(Math.min(a*(e.y()/t),j.height*a-1),0),r=Math.max(a*e.radius()/t,1);e.x(n),e.y(i),e.radius(r),e.fillPatternOffset({x:n,y:i}),e.fillPatternScale({x:a,y:a}),p.add(e)}))})),d.on("mouseenter",(function(e){b.visible(!0),d.container().style.cursor="none"})),d.on("mouseleave",(function(e){b.visible(!1),d.container().style.cursor="default",p.draw()})),d.on("mousemove",(function(e){var t=e.evt.layerX-i,n=e.evt.layerY-i;b.x(t),b.y(n),b.fillPatternOffset({x:t,y:n}),p.batchDraw()})),d.on("mousedown dragmove",(function(e){var t=o(e.evt.layerX-i,e.evt.layerY-i,1);p.add(t),s.push(t),p.batchDraw()})),d.on("mouseup dragend dragleave dragexit",(function(){var e=c.slice();e.push(s),l(e)})),p.draw()}),[A,m,n,r,j,c,l]),Object(a.useEffect)((function(){var e=document.getElementById(u);function t(){(A<e.offsetWidth-1||e.offsetWidth<e.scrollWidth)&&p(e.offsetWidth),(m<e.offsetHeight-1||e.offsetHeight<e.scrollHeight)&&O(e.offsetHeight)}return t(),window.addEventListener("resize",t),function(){window.removeEventListener("resize",t)}}),[j,A,m]),Object(P.jsx)("div",{children:Object(P.jsx)("div",Object(o.a)({id:u},d))})}function I(e){var t=e.id,n=e.src,i=e.shadingColor,r=e.shadingOpacity,c=e.selections,l=Object(k.a)(e,["id","src","shadingColor","shadingOpacity","selections"]),d="ScaledImage_"+t,u=Object(a.useState)(0),h=Object(s.a)(u,2),j=h[0],f=h[1],b=Object(a.useState)(new Image),A=Object(s.a)(b,1)[0];return A.src=n,Object(a.useEffect)((function(){var e=document.getElementById(d);function t(){A.width===e.offsetWidth&&e.offsetWidth===e.scrollWidth||f(e.offsetWidth)}return t(),window.addEventListener("resize",t),A.onload=function(){var e=j/A.width,t=new M.a.Stage({container:d,width:j,height:A.height*e}),n=new M.a.Image({x:0,y:0,width:A.width*e,height:A.height*e,image:A}),a=new M.a.Rect({x:0,y:0,width:n.width(),height:n.height(),fill:i,strokeWidth:0,opacity:r,visible:!0}),s=new M.a.Layer;s.add(n),s.add(a),c.forEach((function(t){t.forEach((function(t){s.add(function(t){var n=t.fillPatternScaleX();n!==t.fillPatternScaleY()&&console.error("Inconsistent scale");var a=Math.max(Math.min(e*(t.x()/n),A.width*e-1),0),i=Math.max(Math.min(e*(t.y()/n),A.height*e-1),0),r=Math.max(e*t.radius()/n,1);return new M.a.Circle({x:a,y:i,radius:r,fillPatternImage:t.fillPatternImage(),fillPatternOffset:{x:a,y:i},fillPatternScale:{x:e,y:e},opacity:t.opacity()})}(t))}))})),t.add(s),s.draw()},function(){window.removeEventListener("resize",t)}}),[d,A,j,i,r,c]),Object(P.jsx)("div",Object(o.a)({id:d},l))}var T=n(137),H=n.n(T),F=Object(y.a)((function(e){return{masonry:{display:"flex",marginLeft:"-10px"},masonryColumn:{paddingLeft:"10px"},masonryCell:{marginTop:"10px",position:"relative","&:hover":{cursor:"pointer",opacity:e.palette.action.hoverOpacity}}}}));function R(e){var t=e.input,n=e.setInput,i=e.detailList,r=e.setDetailList,c=e.endDetailSearch,o=F(),l=Object(a.useState)(t),d=Object(s.a)(l,2),u=d[0],h=d[1],j=Object(a.useState)(t.cloneSelections()),f=Object(s.a)(j,2),A=f[0],p=f[1],g="black";function x(e){r({type:"remove",payload:e})}var m,O=[{datum:t,deleteFunc:function(e){if(0!==i.length){var t=i[0];r({type:"remove",payload:t}),n(t)}else n(void 0)}}].concat(i.map((function(e){return{datum:e,deleteFunc:x}})));if("undefined"!==typeof u){var v=function(){return{stack:A.stack.slice(0,A.current+1),current:A.current}};m=Object(P.jsxs)(P.Fragment,{children:[Object(P.jsx)(w.a,{item:!0,xs:12,children:Object(P.jsx)(b.a,{variant:"h3",children:"Click and draw over the image to highlight areas of interest."})}),Object(P.jsx)(w.a,{item:!0,xs:10,children:Object(P.jsx)(E,{src:u.url,shadingColor:g,shadingOpacity:.5,selections:A.stack[A.current],setSelections:function(e){var t=A.current+1,n=A.stack.slice(0,t);n.push(e),p({stack:n,current:t})}})}),Object(P.jsx)(w.a,{container:!0,item:!0,xs:2,children:Object(P.jsxs)(w.a,{item:!0,xs:11,children:[Object(P.jsx)(C.a,{fullWidth:!0,onClick:function(){var e=u.clone();e.selections=v(),e.aid===t.aid?n(e):r({type:"update",payload:e}),h(void 0)},disabled:function(){var e=v();if(e.stack.length!==u.selections.stack.length)return!1;if(e.current!==u.selections.current)return!1;for(var t=0;t<e.stack.length;t++)if(e.stack[t].length!==u.selections.stack[t].length)return!1;for(var n=0;n<e.stack.length;n++)for(var a=0;a<e.stack[n].length;a++){var i=e.stack[n][a],r=u.selections.stack[n][a];if(i.radius!==r.radius)return!1;if(i.x!==r.x)return!1;if(i.y!==r.y)return!1}return!0}(),children:"Update selections"}),Object(P.jsx)("div",{style:{paddingTop:"2vh"}}),Object(P.jsx)(C.a,{fullWidth:!0,disabled:0===A.current,onClick:function(){p({stack:A.stack,current:A.current-1})},children:"Undo"}),Object(P.jsx)(C.a,{fullWidth:!0,disabled:A.current===A.stack.length-1,onClick:function(){p({stack:A.stack,current:A.current+1})},children:"Redo"}),Object(P.jsx)(C.a,{fullWidth:!0,disabled:0===A.current,onClick:function(){p({stack:[[]],current:0})},children:"Clear"})]})})]})}return Object(P.jsx)(w.a,{container:!0,children:Object(P.jsxs)(w.a,{container:!0,children:[Object(P.jsxs)(w.a,{container:!0,item:!0,xs:4,children:[Object(P.jsx)(w.a,{item:!0,xs:12,children:Object(P.jsx)(C.a,{onClick:c,children:"Back to results"})}),Object(P.jsx)(w.a,{item:!0,xs:12,children:Object(P.jsx)(S.a,{breakpointCols:2,className:o.masonry,columnClassName:o.masonryColumn,children:O.map((function(e){return Object(P.jsxs)("div",{className:o.masonryCell,children:[Object(P.jsx)(I,{id:e.datum.aid,src:e.datum.url,shadingColor:g,shadingOpacity:0===e.datum.selections.current?0:.5,selections:e.datum.selections.stack[e.datum.selections.current],onClick:function(){p(e.datum.cloneSelections()),h(e.datum)}}),Object(P.jsx)(H.a,{style:{position:"absolute",top:0,right:0},onClick:function(){e.deleteFunc(e.datum)}})]},e.datum.aid)}))})})]}),Object(P.jsx)(w.a,{container:!0,item:!0,xs:8,align:"right",children:m})]})})}var B=n(296),N=n(307),W=n(280),z=n(154);function U(e){var t=e.input,n=e.detailList,a=e.onNewSearch,i=e.onDetailSearch,r=e.fetching;return Object(P.jsxs)(f.a,{children:[Object(P.jsx)("div",{style:{position:"relative",top:0,left:0},children:Object(P.jsx)(z.a,{images:[t.url].concat(n.map((function(e){return e.url}))),hideOverlay:!0,countFrom:4})}),Object(P.jsxs)(w.a,{container:!0,style:{paddingTop:"3vh"},spacing:2,children:[Object(P.jsx)(w.a,{item:!0,xs:6,children:Object(P.jsx)(C.a,{fullWidth:!0,disabled:r,onClick:a,children:"Update search"})}),Object(P.jsx)(w.a,{item:!0,xs:6,align:"right",children:Object(P.jsx)(C.a,{fullWidth:!0,disabled:r,onClick:i,children:"Edit search"})})]}),Object(P.jsx)("div",{style:{paddingTop:"6vh"}}),Object(P.jsxs)(W.a,{fullWidth:!0,children:[Object(P.jsx)(N.a,{id:"recentSearchesLabel",children:"\xa0Recent searches"}),Object(P.jsxs)(B.a,{labelId:"recentSearchesLabel",disabled:r,children:[Object(P.jsx)("option",{children:"Placeholder recent 1"}),Object(P.jsx)("option",{children:"Placeholder recent 2"})]})]}),Object(P.jsx)("div",{style:{paddingTop:"1vh"}}),Object(P.jsxs)(W.a,{fullWidth:!0,children:[Object(P.jsx)(N.a,{id:"savedCollectionsLabel",children:"\xa0Saved collections"}),Object(P.jsxs)(B.a,{labelId:"savedCollectionsLabel",disabled:r,children:[Object(P.jsx)("option",{children:"Placeholder saved 1"}),Object(P.jsx)("option",{children:"Placeholder saved 2"})]})]})]})}var Q=n(46),X=n(304),V=n(281),J=n(282),G=n(303),q=n(300),K=n(283),Z=n(148),Y=n.n(Z),_=n(147),$=n.n(_),ee=n(145),te=n(146),ne=function(){function e(t,n){Object(ee.a)(this,e),this.aid=t,this.url=n,this.selections={stack:[[]],current:0}}return Object(te.a)(e,[{key:"clone",value:function(){var e=Object.create(this);return e.selections=this.cloneSelections(),e}},{key:"cloneSelections",value:function(){return{stack:this.selections.stack.map((function(e){return e.slice()})),current:this.selections.current}}}]),e}(),ae="https://decade.ac.uk/deepdiscovery/api/upload";function ie(e,t,n,a){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"Style",r=arguments.length>5&&void 0!==arguments[5]&&arguments[5],c=new FormData;e&&(e.file?c.append("query_file",e.file):e.aid?c.append("query_aid",e.aid):c.append("query_url",e.url)),c.append("searchengine",i),c.append("resultcount",t),n&&c.append("weights",se(n));var s=new URLSearchParams(window.location.search);c.append("weightfactor",s.has("w")?s.get("w"):10);var o=new XMLHttpRequest;o.open("POST",ae,!r),o.onload=function(){var e=JSON.parse(this.responseText);e=e.filter((function(e){return null!=e.collection&&null!=re(e.collection).name})),a(e)},o.send(c)}function re(e){if(null==e)return null;var t={id:e};return t.name="RGBE"===e?"Royal Botanic Garden Edinburgh":"TNA1"===e||"TNA2"===e||"TNA3"===e?"The National Archives":"VA1"===e||"VA2"===e?"Victoria & Albert Museum":null,t}function ce(e,t){var n=e.fillPatternScaleX();n!==e.fillPatternScaleY()&&console.error("Inconsistent scale");for(var a=Math.max(Math.min(e.x()/n,t.length-1),0),i=Math.max(Math.min(e.y()/n,t[0].length-1),0),r=e.radius()/n,c=Math.max(Math.round(i-r),0),s=Math.min(Math.round(i+r),t[0].length-1),o=Math.max(Math.round(a-r),0),l=Math.min(Math.round(a+r),t.length-1),d=Math.round(r*r),u=!1,h=o;h<=l;h++)for(var j=c;j<=s;j++){var f=h-a,b=j-i;(f*=f)+(b*=b)<d&&(u=!0,t[h][j]=1)}u||(t[Math.round(a)][Math.round(i)]=1)}function se(e){var t,n=[],a=Object(Q.a)(e);try{for(a.s();!(t=a.n()).done;){var i=t.value,r=new Image;r.src=i.url;for(var c=i.aid+"*"+r.naturalWidth+"*"+r.naturalHeight+"*",s=new Array(r.naturalWidth),o=0;o<s.length;o++)s[o]=new Array(r.naturalHeight);if(0===i.selections.stack[i.selections.current].length)for(var l=0;l<s.length;l++)s[l].fill(1);else{for(var d=0;d<s.length;d++)s[d].fill(0);var u,h=Object(Q.a)(i.selections.stack[i.selections.current]);try{for(h.s();!(u=h.n()).done;){var j,f=u.value,b=Object(Q.a)(f);try{for(b.s();!(j=b.n()).done;){ce(j.value,s)}}catch(m){b.e(m)}finally{b.f()}}}catch(m){h.e(m)}finally{h.f()}}for(var A=[],p=0;p<r.naturalHeight;p++){for(var g="",x=0;x<r.naturalWidth;x++)g+=s[x][p];A.push(g)}n.push(c+A.join(""))}}catch(m){a.e(m)}finally{a.f()}return n.join("")}var oe=Object(y.a)((function(e){return{masonry:{display:"flex",marginLeft:"-10px"},masonryColumn:{paddingLeft:"10px"},masonryCell:{marginBottom:"10px"}}}));function le(e){e.input;var t=e.results,n=(e.setResults,e.detailList),i=e.setDetailList,r=e.fetching,c=oe(),o=Object(a.useState)(2),l=Object(s.a)(o,2),d=l[0],u=l[1],h=Object(a.useState)(!1),j=Object(s.a)(h,2),A=j[0],p=j[1];return Object(P.jsxs)(f.a,{children:[Object(P.jsx)(v.a,{}),Object(P.jsx)(b.a,{variant:"h2",align:"left",children:"Similar Images"}),Object(P.jsxs)(w.a,{container:!0,children:[Object(P.jsx)(w.a,{item:!0,xs:6,children:Object(P.jsxs)(X.a,{style:{width:"100%"},exclusive:!0,value:A,onChange:function(e,t){!0!==t&&!1!==t||p(t)},children:[Object(P.jsx)(V.a,{style:{borderRadius:"5px 0   0   5px",width:"50%"},value:!1,disabled:!A,children:"Image view"}),Object(P.jsx)(V.a,{style:{borderRadius:"0   5px 5px 0",width:"50%"},value:!0,disabled:A,"data-tip":'<div><p align="center">Areas of the image that are recognised as most or least alike. The left side (blue) is least alike. The right side (red) is most alike.</p><svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="245px" height="24px" viewBox="0 0 245 24" enable-background="new 0 0 245 24" xml:space="preserve">  <image id="image0" width="245" height="24" x="0" y="0" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPUAAAAYCAMAAAAVtUsLAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAC4lBMVEUAAIEAAIQAAIcAAI0AAJEAAJUBAJoAAJ0AAKIAAKYAAKsAAK8AALQAALcAALsAAL8AAMIAAMUAAMsAANAAANQBANgAANwAAOAAAOQAAOgAAO0AAPMAAPYAAPkAAvwABP4ACP8ADP8AEP4AFP4AGf8AHf8AIf8AJv8AKf8ALf4AMf4ANf4AOf4AP/4AQv8AR/8AS/8AT/8AVP8AV/4AW/4AX/8AZP8BZ/8AbP8AcP4AdP4AeP8Ae/4Af/4AhP4BiP8Ai/8Akf8Alf8AmP4Anf8Aof8Apf8Aqf8Arv4Asf4Btv8Buf8Avf8Awv8Axf8Ayv8Azv8A0/8A1/8A2/4A4f8A5P8A5/8A6/8A8P4A8/4B+P8C/P4D/vsH//gK//QO//AS/+0X/+gb/+Mf/98i/94n/9ks/9Mw/s82/so5/8c9/8JB/75F/7lH/7dM/7NR/61V/6lZ/6Rd/6Fh/55l/5tq/5Vu/5Fz/4x4/4d7/oR+/3+B/3uE/3eI/3WO/3CS/2yX/2ec/2Of/2Cj/1um/1ir/1Sw/1C1/0u3/0e8/0PA/z7E/zrI/zfL/zPQ/y7U/yrZ/yXd/yLh/x7l/xnp/xXu/xHy/gz3/gn7/gb+/QT/+wH/9gD+8gD/7gD+6QD+5gD/4gD/3gD+2QD/1gD/0QD/zAH/yAH/xAH+wAD/vAD/uAD+tAD+sQD+rAD/pwH/owH/nwH/mwD/lgD/kgD/jgH/igH/hgH/gQD/fgD/egD/dwD/cgD/bgD/aQD/ZgD/YQD/XQD+WQD+VQD+UQH/TAH/SAH/RAD/QQD/PAD/OAD/NAD/MQD+LAD+JwD/JAH+HwD+HAD/FwD/EgH/DgH/CwH/BwD+AwD7AQD4AAD1AADxAADqAADnAADiAADfAQDaAADWAADSAADOAQDJAQHEAQLBAAG9AAC5AAC2AQCzAACtAACpAAClAACgAQGdAACXAACUAACQAAGMAAGIAACFAAD///+0LjPXAAAAAWJLR0T1RdIb2wAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB+UFHBIeAwqYXr0AAAFASURBVFjDY2BgZGJmYWVj5+Dk4ubh5eMXEBQSFhEVE5eQlJKWkZWTV1BUUlZRVVPX0NTS1tHV0zcwNDI2MTUzt7C0sraxtbN3cHRydnF1c/fw9PL28fXzDwgMCg4JDQuPiIyKjomNi09ITEpOSU1Lz8jMys7JzcsvKCwqLiktK6+orKquqa2rb2hsam5pbWvv6Ozq7unt658wcdLkKVOnTZ8xc9bsOXPnzV+wcNHiJUuXLV+xctXqNWvXrd+wcdPmLVu3bd+xc9fuPXv37T9w8NDhI0ePHT9x8tTpM2fPnb9w8dLlK1evXb9x89btO3fv3X/w8NHjJ0+fPX/x8tXrN2/fvf/w8dPnLwyjvh719aivR3096utRX4/6etTXo74e9fWor0d9PerrUV+P+nrU16O+HvX1qK9HfT3q6xHmawBSUfLHjvdTOwAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAyMS0wNS0yOFQxNzozMDowMyswMTowMHLbfNcAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMjEtMDUtMjhUMTc6MzA6MDMrMDE6MDADhsRrAAAAAElFTkSuQmCC"/></svg></div>',"data-html":!0,"data-effect":"solid","data-place":"bottom",children:"Likeness view"})]})}),Object(P.jsx)(w.a,{item:!0,xs:3,children:Object(P.jsx)("div",{})}),Object(P.jsxs)(w.a,{container:!0,item:!0,xs:3,children:[Object(P.jsx)(w.a,{item:!0,xs:12,children:Object(P.jsx)(b.a,{style:{fontSize:12,lineHeight:1,textTransform:"uppercase"},children:"Image Size"})}),Object(P.jsx)(w.a,{item:!0,xs:2,align:"left",children:Object(P.jsx)(J.a,{size:"small",color:"primary",disabled:r,onClick:function(){return u((function(e){return e>1?e-1:e}))},children:Object(P.jsx)($.a,{})})}),Object(P.jsx)(w.a,{item:!0,xs:8,children:Object(P.jsx)(G.a,{value:d,disabled:r,onChange:function(e,t){u(t)},step:1,min:1,max:3})}),Object(P.jsx)(w.a,{item:!0,xs:2,align:"right",children:Object(P.jsx)(J.a,{size:"small",color:"primary",disabled:r,onClick:function(){return u((function(e){return e<3?e+1:e}))},children:Object(P.jsx)(Y.a,{})})})]})]}),r?Object(P.jsx)(K.a,{style:{marginTop:"3vh",height:"50vh",width:"50vh"}}):Object(P.jsx)(S.a,{breakpointCols:5-d,className:c.masonry,columnClassName:c.masonryColumn,style:{paddingTop:"3vh"},children:t.map((function(e){return Object(P.jsx)(de,{className:c.masonryCell,result:e,detailList:n,setDetailList:i,showLikeness:A,tileSize:d},e.aid)}))})]})}function de(e){var t,n,a=e.result,i=e.detailList,r=e.setDetailList,c=(e.tileSize,e.showLikeness),s=Object(k.a)(e,["result","detailList","setDetailList","tileSize","showLikeness"]),l=!1,d=Object(Q.a)(i);try{for(d.s();!(t=d.n()).done;){var u=t.value;if(a.aid===u.aid){l=!0;break}}}catch(h){d.e(h)}finally{d.f()}return c&&(n=Object(P.jsx)("img",{style:{height:"100%",width:"100%",padding:0,margin:0,position:"absolute",top:0,left:0,zIndex:2},src:a.heatmapurl})),Object(P.jsx)(A.a,Object(o.a)(Object(o.a)({},s),{},{variant:"outlined",style:{borderColor:"#292929",borderRadius:"5px 5px 0 0"},children:Object(P.jsxs)(p.a,{style:{margin:0,padding:0},children:[Object(P.jsxs)(w.a,{container:!0,justify:"space-between",children:[Object(P.jsx)(w.a,{item:!0,children:Object(P.jsx)(q.a,{style:{margin:0,padding:0},checked:l,onChange:function(){r({type:l?"remove":"add",payload:a.clone()})}})}),Object(P.jsx)(w.a,{item:!0,children:Object(P.jsx)(b.a,{style:{paddingRight:"3px"},children:re(a.collection).name})})]}),Object(P.jsxs)("div",{style:{position:"relative",top:0,left:0},children:[Object(P.jsx)("img",{style:{height:"100%",width:"100%",padding:0,margin:0,position:"relative",top:0,left:0,zIndex:1},src:a.url}),n]})]})}))}function ue(e){var t=e.input,n=e.setInput,i=(e.update,Object(a.useState)(!1)),r=Object(s.a)(i,2),c=r[0],o=r[1];function l(){c||(o(!0),ie(t,33,[t].concat(A),(function(e){t.aid&&(e=e.filter((function(e){return e.aid!==parseInt(t.aid)}))),j({type:"replace",payload:e.map((function(e){var t=new ne(e.aid,e.url);return t.collection=e.collection,t.heatmapurl=e.heatmapurl,t}))})})))}var d=Object(a.useReducer)((function(e,t){var n=t.payload;switch(o(!1),t.type){case"replace":return n;case"update":return e.map((function(e){return e.aid===n.aid?n:e}));default:throw new Error}}),[]),u=Object(s.a)(d,2),h=u[0],j=u[1],f=Object(a.useReducer)((function(e,t){var n=t.payload;switch(t.type){case"add":return e.concat(n);case"remove":for(var a=0;a<e.length;a++)if(n.aid===e[a].aid)return e.splice(a,1),e.slice();return console.warn("Attempted to remove non-member from detailList",n,e),e.slice();case"update":return e.map((function(e){return e.aid===n.aid?n:e}));default:throw new Error}}),[]),b=Object(s.a)(f,2),A=b[0],p=b[1],g=Object(a.useState)(!1),x=Object(s.a)(g,2),m=x[0],O=x[1];return 0===h.length&&l(),m?Object(P.jsx)(R,{input:t,setInput:n,results:h,setResults:j,detailList:A,setDetailList:p,endDetailSearch:function(){O(!1),l()}}):Object(P.jsxs)(w.a,{container:!0,spacing:3,children:[Object(P.jsx)(w.a,{item:!0,xs:3,children:Object(P.jsx)(U,{input:t,detailList:A,onNewSearch:function(){l()},onDetailSearch:function(){O(!0)},fetching:c})}),Object(P.jsx)(w.a,{item:!0,xs:9,children:Object(P.jsx)(le,{input:t,results:h,setResults:j,detailList:A,setDetailList:p,fetching:c})})]})}var he=Object(y.a)((function(e){return{uploadText:{textAlign:"center",color:"#3030EE","&:hover":{color:"#3090EE",cursor:"pointer"}},inputZone:{background:"#F5F5F5",border:"1px dashed #595959",boxSizing:"border-box",borderRadius:"5px",textAlign:"center"},tile:{"&:hover":{opacity:e.palette.action.hoverOpacity,cursor:"pointer"}}}}));function je(){for(var e=he(),t=Object(a.useState)(),n=Object(s.a)(t,2),i=n[0],r=n[1],c=function(e){var t,n=new URLSearchParams(window.location.search),a=[];if(n.has("f")){var i,r=Object(Q.a)(n.get("f").split(";"));try{for(r.s();!(i=r.n()).done;){var c=i.value.split(","),o=Object(s.a)(c,2),l=o[0],d=o[1],u=void 0;isNaN(l)?(u=l,l=0):u="https://s3.eu-west-2.amazonaws.com/deepdiscovery.thumbnails/"+d+"/"+l+".jpg";var h=new ne(l,u);h.collection=d,a.push(h)}}catch(j){r.e(j)}finally{r.f()}}return ie(null,e-a.length,null,(function(e){t=e}),"Random",!0),a.concat(t)}(8),o=0;o<4;o++)c[o].tooltip_pos="top";for(var l=4;l<8;l++)c[l].tooltip_pos="bottom";function A(e){return p.apply(this,arguments)}function p(){return(p=Object(u.a)(d.a.mark((function e(t){var n,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){var n=new FileReader;n.onload=function(t){e(t.target.result)},n.readAsDataURL(t)}));case 2:n=e.sent,(a=new ne(0,n)).file=t,r(a);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return"undefined"===typeof i?Object(P.jsxs)(g.a,{backend:O.a,children:[Object(P.jsx)(v.a,{}),Object(P.jsxs)(f.a,{style:{width:"50vw"},justify:"center",children:[Object(P.jsx)(b.a,{variant:"h1",align:"center",children:"Explore our National Collection"}),Object(P.jsx)(b.a,{style:{color:"#717171",paddingBottom:"1rem"},align:"center",children:"Search with an image to find similar results"}),Object(P.jsx)(be,{style:{paddingBottom:"1rem"},onFileDrop:function(e){return A(e)},onURLDrop:function(e){return r(new ne(0,e))},onAssetDrop:function(e){return r(new ne(e.aid,e.url))},onFileUpload:function(e){return A(e.target.files[0])}}),Object(P.jsx)(Ae,{style:{paddingBottom:"1rem"},children:Object(P.jsx)(b.a,{children:"\xa0Or\xa0"})}),Object(P.jsx)(b.a,{style:{paddingBottom:"1rem"},align:"center",children:"Click a sample image to try it"}),Object(P.jsx)(h.a,{cols:4,style:{justifyContent:"center"},spacing:.01*document.documentElement.clientWidth,children:c.map((function(t){return Object(P.jsx)(j.a,{style:{height:"11vw",width:"11vw"},"data-tip":re(t.collection).name,"data-effect":"solid","data-place":t.tooltip_pos,children:Object(P.jsx)(fe,{className:e.tile,asset:t,onClick:function(){return r(new ne(t.aid,t.url))}})},t.aid)}))})]})]}):Object(P.jsx)(ue,{input:i,setInput:r})}function fe(e){var t=e.className,n=e.asset,a=e.onClick,i=Object(x.a)({type:"ASSET",item:{asset:n}}),r=Object(s.a)(i,2)[1];return Object(P.jsx)("img",{className:t,ref:r,onClick:a,src:n.url,height:"100%",width:"100%",style:{objectFit:"cover"}})}function be(e){var t=e.style,n=e.onFileDrop,a=e.onURLDrop,i=e.onAssetDrop,r=e.onFileUpload,c=he(),o=Object(m.a)({accept:[O.b.FILE,O.b.URL,"ASSET"],drop:function(e,t){if(t.getItemType()===O.b.FILE){var r=t.getItem().files;if(1!==r.length)return;var c=r[0];if("image/jpeg"!==c.type&&"image/png"!==c.type)return;n(c)}else if(t.getItemType()===O.b.URL){var s=t.getItem().urls;if(1!==s.length)return;var o=s[0],l=o.substring(o.lastIndexOf(".")+1);if("jpg"!==l&&"jpeg"!==l&&"png"!==l)return;a(o)}else if("ASSET"===t.getItemType()){var d=t.getItem().asset;i(d)}}}),l=Object(s.a)(o,2)[1];return Object(P.jsx)("div",{ref:l,style:t,children:Object(P.jsx)(A.a,{className:c.inputZone,children:Object(P.jsx)(p.a,{style:{height:"30vh",display:"flex",flexDirection:"column",justifyContent:"center"},children:Object(P.jsxs)(b.a,{children:["Drag an image here or",Object(P.jsxs)("label",{className:c.uploadText,children:[Object(P.jsx)("input",{style:{display:"none"},type:"file",accept:"image/jpeg,image/png",onChange:r}),"\xa0browse files on this computer"]})]})})})})}function Ae(e){var t=e.style,n=e.children;return Object(P.jsxs)("div",{style:Object(o.a)({alignItems:"center",display:"flex"},t),children:[Object(P.jsx)("div",{style:{border:"1px solid #E9E9E9",width:"50%"}}),n,Object(P.jsx)("div",{style:{border:"1px solid #E9E9E9",width:"50%"}})]})}var pe=n(153),ge=n(290),xe=n(107),me=n(291),Oe=n(292),ve=n(152),ye=n.n(ve),we=n(151),Ce=n.n(we),De=n(155),Se=n(302),ke=n(305),Le=n(301),Me=n(293),Pe=n(294),Ee=n(295),Ie="#292929",Te="#FFFFFF",He="#1F1F4D",Fe="2px solid",Re="5px",Be=Object(pe.a)({typography:{fontFamily:'"Open Sans", sans-serif',fontWeightRegular:500,h1:{fontSize:"2rem",lineHeight:"3rem"},h2:{fontWeight:600,fontSize:"1.5rem",lineHeight:"3rem"},h3:{fontSize:"1.3rem",lineHeight:"3rem"},button:{fontSize:"1.1rem"}},palette:{primary:{main:Ie},text:{primary:Ie},action:{hoverOpacity:.8}},overrides:{MuiButton:{root:{border:Fe,borderColor:Ie,borderRadius:Re,textTransform:"none","&:hover":{backgroundColor:He,color:Te}}},MuiToggleButton:{root:{border:Fe,borderColor:Ie,borderRadius:Re,textTransform:"none",color:Ie,"&:hover":{backgroundColor:Object(xe.fade)(He,.8),borderColor:Ie,color:Te},"&$selected":{backgroundColor:He,borderColor:Ie,color:Te},"&$disabled":{backgroundColor:He,borderColor:Ie,color:Te}}},MuiSelect:{root:{border:Fe,borderRadius:Re}},MuiCheckbox:{colorSecondary:{"&$checked":{color:He},"&:hover":{backgroundColor:Object(xe.fade)(He,.8)}}},MuiSlider:{root:{color:He}},MuiCircularProgress:{colorPrimary:{color:He}}}});function Ne(){var e=Object(a.useState)(null),t=Object(s.a)(e,2),n=t[0],i=t[1],r=Object(a.useState)(!1),c=Object(s.a)(r,2),o=c[0],l=c[1];return Object(P.jsx)("div",{children:Object(P.jsxs)(ge.a,{theme:Be,children:[Object(P.jsx)(me.a,{style:{backgroundColor:"#3f51b5"},position:"fixed",children:Object(P.jsxs)(Oe.a,{children:[Object(P.jsx)(J.a,{onClick:function(){window.location.reload()},children:Object(P.jsx)(Ce.a,{style:{color:"white"}})}),Object(P.jsx)(J.a,{onClick:function(e){i(e.currentTarget)},children:Object(P.jsx)(ye.a,{style:{color:"white"}})}),Object(P.jsx)(De.a,{anchorEl:n,open:Boolean(n),children:Object(P.jsxs)(Se.a,{onMouseLeave:function(){i(null)},children:[Object(P.jsx)(ke.a,{children:Object(P.jsx)("a",{href:"https://tanc-ahrc.github.io/DeepDiscoveries/",children:"Project website"})}),Object(P.jsx)(ke.a,{children:Object(P.jsx)("a",{href:"https://github.com/tanc-ahrc/deep-discoveries-frontend",children:"Source (GitHub)"})}),Object(P.jsx)(ke.a,{onClick:function(){l(!0)},children:"About"})]})})]})}),Object(P.jsxs)(Le.a,{open:o,onClose:function(){l(!1)},children:[Object(P.jsx)(Me.a,{children:"About"}),Object(P.jsxs)(Pe.a,{children:[Object(P.jsx)(Ee.a,{children:"Site designed by the Deep Discoveries Team."}),Object(P.jsx)(Ee.a,{children:"Copyright \xa9 2021 Crown Copyright (The National Archives) except where otherwise stated in the source code."}),Object(P.jsx)(Ee.a,{children:"Licensed under the MIT License."}),Object(P.jsxs)(Ee.a,{children:["See ",Object(P.jsx)("a",{href:"https://github.com/tanc-ahrc/deep-discoveries-frontend",children:"source code"})," for details."]})]})]}),Object(P.jsxs)("div",{style:{position:"relative",top:"10vh"},children:[Object(P.jsx)(je,{}),Object(P.jsx)(b.a,{style:{marginTop:"10vh",position:"relative"},align:"center",children:"Images \xa9 Victoria and Albert Museum, London, \xa9 Royal Botanic Garden Edinburgh and \xa9 Crown Copyright (The National Archives)"})]})]})})}var We=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,308)).then((function(t){var n=t.getCLS,a=t.getFID,i=t.getFCP,r=t.getLCP,c=t.getTTFB;n(e),a(e),i(e),r(e),c(e)}))};c.a.render(Object(P.jsx)(i.a.StrictMode,{children:Object(P.jsx)(Ne,{})}),document.getElementById("root")),We()}},[[227,1,2]]]);
//# sourceMappingURL=main.3d468b92.chunk.js.map